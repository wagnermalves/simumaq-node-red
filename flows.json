[{"id":"90565ab.23a4fa8","type":"tab","label":"Tse-simu-maq-geral","disabled":false,"info":""},{"id":"42adf1ec.1a792","type":"tab","label":"Tse-simu-Linha01-Maq01","disabled":false,"info":""},{"id":"39d3df0.a28d222","type":"tab","label":"Tse-simu-OEE-Historico","disabled":false,"info":""},{"id":"987e97a8.3da798","type":"subflow","name":"Float32ToUint16","info":"Função recebe float32 e retorna uint16\n\nfloat32ToUint16(value)\n\nReturn array[Low, High]","in":[{"x":121,"y":150,"wires":[{"id":"b7d189bc.365b58"}]}],"out":[{"x":429,"y":151,"wires":[{"id":"b7d189bc.365b58","port":0}]}]},{"id":"e39a571e.ece088","type":"subflow","name":"Uint16ToFloat32","info":"Função recebe uint16 e retorna float32\n\nUint16ToFloat32(array[low,high])\n\nReturn value","in":[{"x":141,"y":116,"wires":[{"id":"6454fa3f.06c984"}]}],"out":[{"x":440,"y":116,"wires":[{"id":"6454fa3f.06c984","port":0}]}]},{"id":"bda1c202.41f74","type":"subflow","name":"ArrayUint16bitToFloat32Bit","info":"","in":[{"x":50,"y":30,"wires":[{"id":"2b5350bd.91f17"}]}],"out":[{"x":426,"y":30,"wires":[{"id":"2b5350bd.91f17","port":0}]}]},{"id":"de1c5af8.1f9b28","type":"ui_base","theme":{"name":"theme-custom","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"Helvetica Neue","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Wagner","default":"#4B7930","baseColor":"#303479","baseFont":"Arial,Arial,Helvetica,sans-serif","reset":false},"themeState":{"base-color":{"default":"#4B7930","value":"#303479","edited":true},"page-titlebar-backgroundColor":{"value":"#333333","edited":true},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#eeeeee","edited":true},"group-borderColor":{"value":"#333333","edited":true},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#23abc5","edited":true},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"Arial,Arial,Helvetica,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Simulador de Maquina","hideToolbar":"false","allowSwipe":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0},"lockMenu":"false","allowTempTheme":"true"}},{"id":"2f9ae54f.0f06ca","type":"ui_spacer","name":"spacer","group":"","order":3,"width":8,"height":1},{"id":"82fb16b2.8358b8","type":"ui_spacer","name":"spacer","group":"","order":4,"width":8,"height":1},{"id":"601c259b.9ae5bc","type":"ui_spacer","name":"spacer","group":"","order":6,"width":8,"height":1},{"id":"7fc6bf3a.c4343","type":"ui_spacer","name":"spacer","group":"","order":7,"width":11,"height":1},{"id":"c2db6bba.412268","type":"ui_spacer","name":"spacer","group":"","order":8,"width":15,"height":1},{"id":"17506b55.847265","type":"ui_spacer","name":"spacer","group":"","order":9,"width":15,"height":1},{"id":"69cc3379.24e66c","type":"ui_spacer","name":"spacer","group":"","order":13,"width":14,"height":1},{"id":"a13311.7a2ddcf","type":"ui_tab","z":"","name":"Linha - Maq","icon":"fa-cogs","order":8,"disabled":false,"hidden":false},{"id":"d1566910.2139f8","type":"ui_group","z":"","name":"Clima Externo","tab":"a13311.7a2ddcf","order":1,"disp":true,"width":5,"collapse":true},{"id":"7b5a5e17.4d119","type":"ui_group","z":"","name":"Motor","tab":"a13311.7a2ddcf","order":3,"disp":true,"width":10,"collapse":true},{"id":"4b508bf3.e86d04","type":"ui_group","z":"","name":"Clima Setor","tab":"a13311.7a2ddcf","order":2,"disp":true,"width":5,"collapse":true},{"id":"fbe4baa6.8db5e8","type":"ui_group","z":"","name":"Status","tab":"a13311.7a2ddcf","order":4,"disp":true,"width":10,"collapse":true},{"id":"660af724.5bdd68","type":"ui_spacer","name":"spacer","group":"6b82859a.b1b75c","order":3,"width":1,"height":1},{"id":"d854fb7b.6ffeb8","type":"ui_spacer","name":"spacer","group":"55e5e349.9a12fc","order":6,"width":1,"height":1},{"id":"3b9abba3.59b464","type":"ui_spacer","name":"spacer","group":"c668d0b4.3287f","order":7,"width":"30","height":1},{"id":"69543932.98cd58","type":"ui_group","z":"","name":"Produção","tab":"a13311.7a2ddcf","order":6,"disp":true,"width":"10","collapse":true},{"id":"94774b35.ea4148","type":"ui_group","z":"","name":"Comandos","tab":"a13311.7a2ddcf","order":5,"disp":true,"width":"10","collapse":true},{"id":"4a143958.0f94f8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"8b2590fd.50568","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"3ad995f8.95e02a","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"1776734d.fce6ed","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"195bd66a.cef02a","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"a6361d50.9148a","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"589ca7d0.89ca28","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"f89c6a0c.74c338","type":"ui_spacer","name":"spacer","group":"","order":8,"width":3,"height":1},{"id":"1e2d337d.3d2fcd","type":"ui_spacer","name":"spacer","group":"","order":4,"width":5,"height":1},{"id":"8b4b86dc.6a0e58","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"99078019.29f6d","type":"ui_spacer","name":"spacer","group":"","order":10,"width":1,"height":1},{"id":"71425cc6.ab63a4","type":"ui_spacer","name":"spacer","group":"","order":12,"width":1,"height":1},{"id":"4a88b746.4fb688","type":"ui_spacer","name":"spacer","group":"","order":14,"width":1,"height":1},{"id":"daf4729d.4a695","type":"ui_group","z":"","name":"OEE","tab":"a13311.7a2ddcf","order":7,"disp":true,"width":"10","collapse":true},{"id":"58b4d8e9.9e5028","type":"MSSQL-CN","z":"","name":"tse-oee-teste-sql-bd","server":"tse-oee-teste.database.windows.net","encyption":true,"database":"tse-oee-teste-sql-bd"},{"id":"d2384a4c.090988","type":"ui_tab","z":"","name":"OEE-Historico","icon":"fa-calendar","order":9,"disabled":false,"hidden":false},{"id":"6926e97d.7c2dd8","type":"ui_group","z":"","name":"OEE Histórico","tab":"d2384a4c.090988","order":1,"disp":true,"width":"10","collapse":false},{"id":"70243443.29f34c","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":3,"width":1,"height":1},{"id":"bc38aa52.2b2d88","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":5,"width":1,"height":1},{"id":"5f0d5926.c434c8","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":7,"width":3,"height":1},{"id":"50a38567.db6bac","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":8,"width":3,"height":1},{"id":"9557ad36.5d95b","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":9,"width":3,"height":1},{"id":"709ced6b.60b2d4","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":11,"width":2,"height":1},{"id":"1bf257fd.56d858","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":14,"width":2,"height":1},{"id":"3afd8ea3.eb0572","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":17,"width":10,"height":1},{"id":"8ebae95f.db8628","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":19,"width":6,"height":1},{"id":"d6a2bec5.f463b","type":"ui_spacer","name":"spacer","group":"6926e97d.7c2dd8","order":23,"width":6,"height":1},{"id":"d4baccc2.538f1","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"e772cef1.77fc4","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"41d65643.c069f8","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"80990107.6281","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"eedeca5f.351c68","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"944e05f4.7fa558","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"99d307c6.ee16f8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":3,"height":1},{"id":"a315e10.4e8442","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"cfab1ab8.c269e8","type":"ui_spacer","name":"spacer","group":"","order":6,"width":3,"height":1},{"id":"471b4705.bba748","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"6eeea7cd.4e8dc8","type":"ui_spacer","name":"spacer","group":"","order":10,"width":2,"height":1},{"id":"e4ea759a.5a18e8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"1e273d29.292d43","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"57284d5c.73c8c4","type":"ui_spacer","name":"spacer","group":"","order":6,"width":2,"height":1},{"id":"b77737fd.394ef8","type":"ui_spacer","name":"spacer","group":"","order":4,"width":5,"height":1},{"id":"abaa1e98.3e7e4","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"19a7580b.db56e8","type":"ui_spacer","name":"spacer","group":"","order":10,"width":1,"height":1},{"id":"c8c838f5.c18698","type":"ui_spacer","name":"spacer","group":"","order":12,"width":1,"height":1},{"id":"1cb1499c.9fd276","type":"ui_spacer","name":"spacer","group":"","order":14,"width":1,"height":1},{"id":"116c818b.19c92e","type":"ui_spacer","name":"spacer","group":"","order":2,"width":6,"height":1},{"id":"92f3fb3e.c97788","type":"ui_spacer","name":"spacer","group":"","order":10,"width":6,"height":1},{"id":"e56fffd6.b1066","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"55ebd57.8d8f22c","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"a3748e86.e803a","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"f3c7c0ab.e778c","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"50ed5001.6b7f4","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"76e277ac.1a8a88","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"4148d6cf.4e7c18","type":"ui_spacer","name":"spacer","group":"","order":2,"width":3,"height":1},{"id":"7665dc84.286664","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"f2009f8a.691bf","type":"ui_spacer","name":"spacer","group":"","order":6,"width":3,"height":1},{"id":"3066fb68.d78dd4","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"237e19c3.0cba16","type":"ui_spacer","name":"spacer","group":"","order":10,"width":2,"height":1},{"id":"f39405c1.2649c8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"8f2154c0.072088","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"47cf0a77.acfbd4","type":"ui_spacer","name":"spacer","group":"","order":6,"width":2,"height":1},{"id":"bf6b587.25279a8","type":"ui_spacer","name":"spacer","group":"","order":4,"width":5,"height":1},{"id":"11eddebc.96a0c1","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"5fc6188c.5b3758","type":"ui_spacer","name":"spacer","group":"","order":10,"width":1,"height":1},{"id":"e8afd74d.1fbd18","type":"ui_spacer","name":"spacer","group":"","order":12,"width":1,"height":1},{"id":"8d80b476.44bfb8","type":"ui_spacer","name":"spacer","group":"","order":14,"width":1,"height":1},{"id":"476ef245.3bd89c","type":"ui_spacer","name":"spacer","group":"","order":2,"width":6,"height":1},{"id":"4c81eb0d.930ec4","type":"ui_spacer","name":"spacer","group":"","order":10,"width":6,"height":1},{"id":"c35cf91a.5fe2d8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"41349b6b.192034","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"d873d0b4.5f73f","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"8c1ff62b.25c2c8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"435bd22f.2c616c","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"11cdbbbe.022254","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"55d0260f.36fd78","type":"ui_spacer","name":"spacer","group":"","order":2,"width":3,"height":1},{"id":"9abf8fbd.a9a09","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"1619e1b3.d6453e","type":"ui_spacer","name":"spacer","group":"","order":6,"width":3,"height":1},{"id":"5ed6dda5.831514","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"51c6c032.c1e9e","type":"ui_spacer","name":"spacer","group":"","order":10,"width":2,"height":1},{"id":"8c55ad06.ff186","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"8f67eea6.5a73","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"ed19a3dc.6aa9e","type":"ui_spacer","name":"spacer","group":"","order":6,"width":2,"height":1},{"id":"8685dbca.70c988","type":"ui_spacer","name":"spacer","group":"","order":4,"width":5,"height":1},{"id":"560e0e7b.ce78f","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"8d30a0bb.e90a1","type":"ui_spacer","name":"spacer","group":"","order":10,"width":1,"height":1},{"id":"8d2ed6ac.92fcc8","type":"ui_spacer","name":"spacer","group":"","order":12,"width":1,"height":1},{"id":"574beaaf.53ed34","type":"ui_spacer","name":"spacer","group":"","order":14,"width":1,"height":1},{"id":"feb16c49.a9c96","type":"ui_spacer","name":"spacer","group":"","order":2,"width":6,"height":1},{"id":"3ba85725.6961a8","type":"ui_spacer","name":"spacer","group":"","order":10,"width":6,"height":1},{"id":"aa224297.5bb92","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"b502a43f.3dc1f8","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"bf66b740.cd55e8","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"390fa467.9e545c","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"70c1cfed.e07e1","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"e72cc75d.dde388","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"4c4093b8.0f60fc","type":"ui_spacer","name":"spacer","group":"","order":2,"width":3,"height":1},{"id":"b4e0183f.6352c8","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"fdc5000a.ce2af","type":"ui_spacer","name":"spacer","group":"","order":6,"width":3,"height":1},{"id":"45a31419.c6adec","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"6f22f9af.1a4038","type":"ui_spacer","name":"spacer","group":"","order":10,"width":2,"height":1},{"id":"df1785eb.4de278","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"88f8c272.12d37","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"3ff73cd0.f0a9f4","type":"ui_spacer","name":"spacer","group":"","order":6,"width":2,"height":1},{"id":"9d7b7e55.4c3b7","type":"ui_spacer","name":"spacer","group":"","order":4,"width":5,"height":1},{"id":"f5f3ceaf.09c6c","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"bdeadbab.06d378","type":"ui_spacer","name":"spacer","group":"","order":10,"width":1,"height":1},{"id":"ab3321c6.a8eea","type":"ui_spacer","name":"spacer","group":"","order":12,"width":1,"height":1},{"id":"2f461074.107ca","type":"ui_spacer","name":"spacer","group":"","order":14,"width":1,"height":1},{"id":"1d38e133.7dec7f","type":"ui_spacer","name":"spacer","group":"","order":2,"width":6,"height":1},{"id":"d9c599d7.9d1db8","type":"ui_spacer","name":"spacer","group":"","order":10,"width":6,"height":1},{"id":"e45335cb.508bf8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"a62e1d93.2f4ef","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"69ca4858.04b7e8","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"2f678fc1.d8144","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"cdf8db16.dc86d8","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"f6f61628.db70e8","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"a1533f35.1a8c2","type":"ui_spacer","name":"spacer","group":"","order":2,"width":3,"height":1},{"id":"19f2c09d.95922f","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"7c17a989.effd38","type":"ui_spacer","name":"spacer","group":"","order":6,"width":3,"height":1},{"id":"ad5d8df.563067","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"da2af559.f753d8","type":"ui_spacer","name":"spacer","group":"","order":10,"width":2,"height":1},{"id":"94895489.579928","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"fad42b68.f48768","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"e7384d12.e2d37","type":"ui_spacer","name":"spacer","group":"","order":6,"width":2,"height":1},{"id":"3a39e450.70e00c","type":"ui_spacer","name":"spacer","group":"","order":4,"width":5,"height":1},{"id":"9dbb4681.d74758","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"96fc9e63.65e1f","type":"ui_spacer","name":"spacer","group":"","order":10,"width":1,"height":1},{"id":"e8abb9c7.f01d88","type":"ui_spacer","name":"spacer","group":"","order":12,"width":1,"height":1},{"id":"dc258945.08fe58","type":"ui_spacer","name":"spacer","group":"","order":14,"width":1,"height":1},{"id":"145d1242.92144e","type":"ui_spacer","name":"spacer","group":"","order":2,"width":6,"height":1},{"id":"56767b3c.c69184","type":"ui_spacer","name":"spacer","group":"","order":10,"width":6,"height":1},{"id":"dcb0ebcd.903ca8","type":"MSSQL-CN","z":"","name":"tse-oee-teste-sql-bd_consulta","server":"tse-oee-teste.database.windows.net","encyption":true,"database":"tse-oee-teste-sql-bd"},{"id":"660dcd95.cb4604","type":"ui_spacer","name":"spacer","group":"d1566910.2139f8","order":2,"width":1,"height":1},{"id":"872a797b.8e43e8","type":"ui_spacer","name":"spacer","group":"d1566910.2139f8","order":4,"width":1,"height":1},{"id":"b6d002b0.38bde","type":"ui_spacer","name":"spacer","group":"d1566910.2139f8","order":6,"width":1,"height":1},{"id":"f77f938d.14618","type":"ui_spacer","name":"spacer","group":"4b508bf3.e86d04","order":2,"width":1,"height":1},{"id":"bc28c7fb.52c398","type":"ui_spacer","name":"spacer","group":"4b508bf3.e86d04","order":4,"width":1,"height":1},{"id":"c608531a.f83d8","type":"ui_spacer","name":"spacer","group":"4b508bf3.e86d04","order":6,"width":1,"height":1},{"id":"ca81c761.785b78","type":"ui_spacer","name":"spacer","group":"fbe4baa6.8db5e8","order":2,"width":3,"height":1},{"id":"ea7c25ce.00f358","type":"ui_spacer","name":"spacer","group":"fbe4baa6.8db5e8","order":4,"width":1,"height":1},{"id":"a1105504.3a3f78","type":"ui_spacer","name":"spacer","group":"fbe4baa6.8db5e8","order":6,"width":3,"height":1},{"id":"ad181bcd.3b8518","type":"ui_spacer","name":"spacer","group":"fbe4baa6.8db5e8","order":8,"width":1,"height":1},{"id":"710bdafa.961854","type":"ui_spacer","name":"spacer","group":"fbe4baa6.8db5e8","order":10,"width":2,"height":1},{"id":"ce250024.9f39","type":"ui_spacer","name":"spacer","group":"94774b35.ea4148","order":3,"width":1,"height":1},{"id":"daa8c6cb.31de98","type":"ui_spacer","name":"spacer","group":"94774b35.ea4148","order":5,"width":3,"height":1},{"id":"89425f3c.15e4e","type":"ui_spacer","name":"spacer","group":"94774b35.ea4148","order":7,"width":2,"height":1},{"id":"4a75a233.f3ae7c","type":"ui_spacer","name":"spacer","group":"69543932.98cd58","order":4,"width":5,"height":1},{"id":"46b3c90b.c1f748","type":"ui_spacer","name":"spacer","group":"69543932.98cd58","order":8,"width":1,"height":1},{"id":"a394415f.00c3e","type":"ui_spacer","name":"spacer","group":"69543932.98cd58","order":10,"width":1,"height":1},{"id":"9e7c70f7.1897c","type":"ui_spacer","name":"spacer","group":"69543932.98cd58","order":12,"width":1,"height":1},{"id":"fa36998f.c33748","type":"ui_spacer","name":"spacer","group":"69543932.98cd58","order":14,"width":1,"height":1},{"id":"669b6c06.3cd354","type":"ui_spacer","name":"spacer","group":"daf4729d.4a695","order":2,"width":6,"height":1},{"id":"db55a690.14e4e8","type":"ui_spacer","name":"spacer","group":"daf4729d.4a695","order":10,"width":6,"height":1},{"id":"3feeb80.5112f48","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"37","height":1},{"id":"a1b66bc7.b1c788","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":1},{"id":"82c4c112.db231","type":"ui_spacer","name":"spacer","group":"","order":4,"width":"9","height":1},{"id":"d09aa509.2e8b58","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"5","height":1},{"id":"bf8b35df.ab2ec8","type":"ui_spacer","name":"spacer","group":"","order":10,"width":"5","height":1},{"id":"3a71a1b5.6058ae","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"5","height":1},{"id":"4767cb32.695f44","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"bbc850f.787f4b","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"9c7996cc.c9dc68","type":"ui_spacer","name":"spacer","group":"","order":5,"width":"1","height":"3"},{"id":"49b5c413.1d3ccc","type":"ui_spacer","name":"spacer","group":"","order":10,"width":"30","height":1},{"id":"34759fac.9bf18","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"38e74c12.765d14","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"e9039790.e9a2e8","type":"ui_spacer","name":"spacer","group":"","order":25,"width":"2","height":1},{"id":"1cc1d146.0e107f","type":"ui_spacer","name":"spacer","group":"","order":27,"width":"4","height":1},{"id":"3ba384ed.382a6c","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"2b931746.2bee48","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"f0d731e4.bd6a9","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"80aa34f8.db0b28","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"5c01a95a.3ba648","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"6f84c0e8.081ad","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"e25b6da3.d9e01","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"eda8b0c1.010df","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"6c541438.f0606c","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"2ec062dd.69a7be","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"3dd8dcff.5b3dd4","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"8de67b3e.6fb2b8","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"f3860887.7e68e8","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"96265bd0.f60868","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"4e706258.51977c","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"982d6281.5e411","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"89f984bf.bfe538","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"f8c8bbd2.3fe188","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"aa46a018.039cf","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"da0970d1.80042","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"6717442f.4a42ac","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"f360329d.0951b","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"402123a9.6c1d0c","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"a0050a26.e88038","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"c685c84d.7c9e28","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"8089ddcc.91cfc","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"b3d7d9ec.0406b8","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"39718c15.25b1d4","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"334b7774.a78428","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":"3"},{"id":"b3a1fb73.826808","type":"ui_spacer","name":"spacer","group":"","order":7,"width":"10","height":1},{"id":"5d0607bc.7c91b8","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":"3"},{"id":"ad862686.95d3e8","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"10","height":1},{"id":"3f8424dc.a5c57c","type":"ui_spacer","name":"spacer","group":"","order":14,"width":"23","height":1},{"id":"a0ecce5d.e4bf1","type":"ui_spacer","name":"spacer","group":"","order":17,"width":"24","height":1},{"id":"ea52f738.a78ec8","type":"ui_spacer","name":"spacer","group":"","order":20,"width":"2","height":1},{"id":"9d2bed30.660be","type":"ui_spacer","name":"spacer","group":"","order":22,"width":"4","height":1},{"id":"7b775a73.0cc584","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"2ff751c5.4f455e","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"3521f445.20b9bc","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"dedbba01.316da8","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"c670665b.4e4b38","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":"3"},{"id":"1e216a0d.f752f6","type":"ui_spacer","name":"spacer","group":"","order":9,"width":"30","height":1},{"id":"90e63491.ddc398","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"23","height":1},{"id":"a377d864.603668","type":"ui_spacer","name":"spacer","group":"","order":16,"width":"24","height":1},{"id":"d3e12444.123a88","type":"ui_spacer","name":"spacer","group":"","order":19,"width":"2","height":1},{"id":"6936ac33.d79a24","type":"ui_spacer","name":"spacer","group":"","order":21,"width":"4","height":1},{"id":"35a2574.1886ba8","type":"ui_spacer","name":"spacer","group":"","order":24,"width":"2","height":1},{"id":"c6bf9596.e58098","type":"ui_spacer","name":"spacer","group":"","order":26,"width":"4","height":1},{"id":"f85f6b14.7bf968","type":"ui_spacer","name":"spacer","group":"","order":30,"width":1,"height":1},{"id":"dc80371b.64e828","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"b2dff37d.7354a","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"71d43a3f.a5be74","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"f7494a68.8e7c18","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"dddeb8b6.a93868","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"b0ccb135.05e07","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"8c403dc3.17c58","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"e41ef923.e51858","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"ab19716d.d0ace","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"1d8d00a5.f7d17f","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"6bc9a7bb.4f50c8","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"23","height":1},{"id":"c2ab036a.1c939","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"9846c166.7a5c2","type":"ui_spacer","name":"spacer","group":"","order":6,"width":"38","height":1},{"id":"932b1d91.ac369","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"6dab5426.fa158c","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"192537d0.30dd08","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":"3"},{"id":"7f1db417.a8bdbc","type":"ui_spacer","name":"spacer","group":"","order":9,"width":"30","height":1},{"id":"7aeedc3a.31eae4","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"23","height":1},{"id":"3c898273.b947ee","type":"ui_spacer","name":"spacer","group":"","order":16,"width":"24","height":1},{"id":"e879492.b34c2b8","type":"ui_spacer","name":"spacer","group":"","order":19,"width":"2","height":1},{"id":"d42385cc.86f0c8","type":"ui_spacer","name":"spacer","group":"","order":21,"width":"4","height":1},{"id":"285621e6.bc658e","type":"ui_spacer","name":"spacer","group":"","order":24,"width":"2","height":1},{"id":"3c2d8f81.747da","type":"ui_spacer","name":"spacer","group":"","order":26,"width":"4","height":1},{"id":"15428803.5d1618","type":"ui_spacer","name":"spacer","group":"","order":30,"width":1,"height":1},{"id":"93e985f4.8f31b8","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"89337f6b.0c0db","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"ab6d8163.c37fe","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":"3"},{"id":"2c9d0a1e.5b2d16","type":"ui_spacer","name":"spacer","group":"","order":9,"width":"30","height":1},{"id":"4265908.a8fcb7","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"23","height":1},{"id":"8671a95e.0f6a88","type":"ui_spacer","name":"spacer","group":"","order":16,"width":"24","height":1},{"id":"78be6ff6.5afed","type":"ui_spacer","name":"spacer","group":"","order":19,"width":"2","height":1},{"id":"80b730fd.705b2","type":"ui_spacer","name":"spacer","group":"","order":21,"width":"4","height":1},{"id":"16a219de.3fd3c6","type":"ui_spacer","name":"spacer","group":"","order":24,"width":"2","height":1},{"id":"2587d967.ffeeb6","type":"ui_spacer","name":"spacer","group":"","order":26,"width":"4","height":1},{"id":"d6cdabcb.fa1828","type":"ui_spacer","name":"spacer","group":"","order":30,"width":1,"height":1},{"id":"3c12c9cd.8416d6","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"d69e904f.9087d","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"66998518.c4ba4c","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":"3"},{"id":"81999463.bc18b8","type":"ui_spacer","name":"spacer","group":"","order":9,"width":"30","height":1},{"id":"c7881641.496118","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"23","height":1},{"id":"166508a1.d2ee67","type":"ui_spacer","name":"spacer","group":"","order":16,"width":"24","height":1},{"id":"9923ce92.044d3","type":"ui_spacer","name":"spacer","group":"","order":19,"width":"2","height":1},{"id":"afb80442.4d53d8","type":"ui_spacer","name":"spacer","group":"","order":21,"width":"4","height":1},{"id":"de0081d1.58a04","type":"ui_spacer","name":"spacer","group":"","order":24,"width":"2","height":1},{"id":"7aef2617.3447a8","type":"ui_spacer","name":"spacer","group":"","order":26,"width":"4","height":1},{"id":"4c8d71d1.787b8","type":"ui_spacer","name":"spacer","group":"","order":30,"width":1,"height":1},{"id":"7a82eed3.82696","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"eb31445e.9bd8f8","type":"ui_spacer","name":"spacer","group":"","order":9,"width":"30","height":1},{"id":"8e70a23f.f81","type":"ui_spacer","name":"spacer","group":"","order":21,"width":"4","height":1},{"id":"c0dc7d4b.7a76d","type":"ui_spacer","name":"spacer","group":"","order":24,"width":"2","height":1},{"id":"317adb00.7acaf6","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"23","height":1},{"id":"3d46959a.834f4a","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"f62c00eb.b5302","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":"3"},{"id":"727c29d0.3e4628","type":"ui_spacer","name":"spacer","group":"","order":19,"width":"2","height":1},{"id":"18da2539.fbc22b","type":"ui_spacer","name":"spacer","group":"","order":16,"width":"24","height":1},{"id":"7e0f190f.c3dd28","type":"ui_spacer","name":"spacer","group":"","order":26,"width":"4","height":1},{"id":"f79665c4.a0f358","type":"ui_spacer","name":"spacer","group":"","order":30,"width":1,"height":1},{"id":"e89a1416.d04fa8","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":"3"},{"id":"ac1bba92.483008","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"8a86519c.85349","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":"3"},{"id":"72f2d2a9.6b62bc","type":"ui_spacer","name":"spacer","group":"","order":9,"width":"30","height":1},{"id":"c557d67a.80faf8","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"23","height":1},{"id":"b46b2a07.e87f38","type":"ui_spacer","name":"spacer","group":"","order":16,"width":"24","height":1},{"id":"ab4760a4.b4299","type":"ui_spacer","name":"spacer","group":"","order":19,"width":"2","height":1},{"id":"f4a27625.d93568","type":"ui_spacer","name":"spacer","group":"","order":21,"width":"4","height":1},{"id":"9888778f.421508","type":"ui_spacer","name":"spacer","group":"","order":24,"width":"2","height":1},{"id":"45c43a54.965754","type":"ui_spacer","name":"spacer","group":"","order":26,"width":"4","height":1},{"id":"4023db3.983b724","type":"ui_spacer","name":"spacer","group":"","order":30,"width":1,"height":1},{"id":"494f2a51.363b84","type":"ui_spacer","name":"spacer","group":"","order":3,"width":"2","height":"3"},{"id":"d523ee29.2f057","type":"ui_spacer","name":"spacer","group":"","order":9,"width":"30","height":"1"},{"id":"f8fa38c9.346b28","type":"ui_spacer","name":"spacer","group":"","order":13,"width":"23","height":1},{"id":"e5c4ed90.54965","type":"ui_spacer","name":"spacer","group":"","order":16,"width":"24","height":1},{"id":"520ca69f.12ee18","type":"ui_spacer","name":"spacer","group":"","order":19,"width":"2","height":1},{"id":"1a2b2b5c.ac4c15","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":"3"},{"id":"684e3e41.6ae0e","type":"ui_spacer","name":"spacer","group":"","order":21,"width":"4","height":1},{"id":"e631cad2.ca3e98","type":"ui_spacer","name":"spacer","group":"","order":24,"width":"2","height":1},{"id":"cc2d359a.aabc68","type":"ui_spacer","name":"spacer","group":"","order":26,"width":"4","height":1},{"id":"8ce6dd4e.67879","type":"ui_spacer","name":"spacer","group":"","order":30,"width":1,"height":1},{"id":"b7d189bc.365b58","type":"function","z":"987e97a8.3da798","name":"Float32ToUint16","func":"function Float32ToUint16(value) {\n  var buffer = new ArrayBuffer(4);\n  var int_value = new Uint16Array(buffer);\n  var float_value = new Float32Array(buffer);\n\n  float_value[0] = value;\n  return [int_value[0], int_value[1]];\n}\n\nvar low, high = {payload : float32ToUint16(msg.payload)}\n\nreturn low, high","outputs":"1","noerr":0,"x":275,"y":150,"wires":[[]]},{"id":"6454fa3f.06c984","type":"function","z":"e39a571e.ece088","name":"Uint16ToFloat32","func":"function Uint16ToFloat32 (low, high) {\n  var buffer = new ArrayBuffer(4);\n  var int_value = new Uint16Array(buffer);\n  var float_value = new Float32Array(buffer);\n\n  int_value[0] = low;\n  int_value[1] = high;\n  return float_value[0];\n}\n\nif (msg.payload.length == 2){\n    msg.payload = uint16ToFloat32(msg.payload[0], msg.payload[1])\n}\n\nreturn msg","outputs":1,"noerr":0,"x":274,"y":119,"wires":[[]]},{"id":"2b5350bd.91f17","type":"function","z":"bda1c202.41f74","name":"converte_16bit_para_float_32bit","func":"var ui16 = new Uint16Array(msg.payload);\nvar fl32 = new Float32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Float32Array.BYTES_PER_ELEMENT);\n\nmsg.payload=fl32;\nreturn msg;\n","outputs":1,"noerr":0,"x":241,"y":30,"wires":[[]]},{"id":"93ddea2a.5d5788","type":"function","z":"90565ab.23a4fa8","name":"Inicialização","func":"const maq = global.get('tse_simu_maq')\n\nlet tse_simu_maquinas = []\nglobal.set('tse_simu_n_linha', [])\nglobal.set('tse_simu_n_maq', [])\nglobal.set(\"tse_selec_maq\", 0)\nglobal.set('tse_simu_idx_rand_liga', 0)\nglobal.set('tse_simu_idx_rand_falha', 0)\nglobal.set('tse_simu_idx_rand_rodando', 0)\nglobal.set('tse_simu_idx_rand_wo', 0)\nglobal.set('tse_simu_idx_rand_pcs', 0)\nglobal.set('tse_simu_chkbox_linhas', new context.global.tse_simu_ckbox_linhas())\n\n\nfor(let linhas in global.get('TodasLinhas')(false).linhas){\n    \n    global.get('tse_simu_chkbox_linhas').linhas[global.get('TodasLinhas')(false).linhas[linhas]] = new context.global.tse_simu_ckbox_op_linha()\n}\n\n//Montando máquinas dinamicamente\nfor(var i=0; i < maq.length ; i++){\n        \n        tse_simu_maquinas[i] = \"tse_simu_\" + maq[i] + \"_online\"\n\t\tglobal.set(tse_simu_maquinas[i], new context.global.tse_simu_maq_online())\n\t\t\n\t\t\n\t\tglobal.get('tse_simu_chkbox_linhas').linhas[(maq[i].split(\"_\"))[0]].Maquinas[(maq[i].split(\"_\"))[1]] = new context.global.tse_simu_ckbox_op_maquina()\n\t\tglobal.get('tse_simu_chkbox_linhas').linhas[(maq[i].split(\"_\"))[0]].id = (maq[i].split(\"_\"))[0]\n\t\tglobal.get('tse_simu_chkbox_linhas').linhas[(maq[i].split(\"_\"))[0]].id_str = \"Linha \" + (maq[i].split(\"_\"))[0].split(\"l\")[1]\n\t\tglobal.get('tse_simu_chkbox_linhas').linhas[(maq[i].split(\"_\"))[0]].Maquinas[(maq[i].split(\"_\"))[1]].id = (maq[i].split(\"_\"))[1]\n\t\tglobal.get('tse_simu_chkbox_linhas').linhas[(maq[i].split(\"_\"))[0]].Maquinas[(maq[i].split(\"_\"))[1]].id_str = \"Maquina \" + (maq[i].split(\"_\"))[1].split(\"m\")[1]\n\t\tglobal.get('tse_simu_n_linha')[i] = (maq[i].split(\"_\"))[0].split(\"l\")[1]\n\t\tglobal.get('tse_simu_n_maq')[i] = (maq[i].split(\"_\"))[1].split(\"m\")[1]\n\t\t\n\t\t\n}\n\nglobal.set('tse_var_maq', tse_simu_maquinas)\nreturn {\"payload\" : \"ok\"}","outputs":1,"noerr":0,"x":270,"y":220,"wires":[["2274964a.f7ba8a"]]},{"id":"1bb2f4ea.38dc1b","type":"inject","z":"90565ab.23a4fa8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":100,"y":100,"wires":[["6fd508a4.c4c488"]]},{"id":"b8305cca.8e38f","type":"comment","z":"90565ab.23a4fa8","name":"Inicialização do sistema","info":"","x":100,"y":40,"wires":[]},{"id":"f30197d7.ae0748","type":"function","z":"90565ab.23a4fa8","name":"Status - Maquina","func":"const maq = global.get('tse_var_maq')[msg.payload]\n\n\nmsg.payload = \"--Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[msg.payload])).slice(-2) + \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[msg.payload])).slice(-2) +\n    \"--\\nLigado : \" + global.get(maq).ligado +\n    \" \\nFalha : \" + global.get(maq).falha +\n    \" \\nRodando : \" + global.get(maq).rodando + \n    \" \\nManutenção : \" + global.get(maq).manutencao + \n    \" \\nWO : \" + global.get(maq).wo + \n    \" \\nWO ini : \" + global.get(maq).wo_ini + \n    \" \\nWO fim : \" + global.get(maq).wo_fim + \n    \" \\nPeças OK : \" + global.get(maq).pecas_ok + \n    \" \\nPeças rep : \" + global.get(maq).pecas_rep +\n    \" \\nQtd peças desejadas : \" + global.get(maq).wo_qtd_pcs\n    \nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":100,"wires":[["ab3cee97.aebb1"]]},{"id":"9dbf3a37.bd4eb8","type":"inject","z":"90565ab.23a4fa8","name":"Linha 01 - Maq01","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":100,"wires":[["f30197d7.ae0748"]]},{"id":"ab3cee97.aebb1","type":"debug","z":"90565ab.23a4fa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1330,"y":100,"wires":[]},{"id":"662a6b24.9df3a4","type":"comment","z":"90565ab.23a4fa8","name":"Verifica - Status Maquina","info":"","x":860,"y":40,"wires":[]},{"id":"d07eb7f3.0362a8","type":"random","z":"42adf1ec.1a792","name":"","low":"0","high":"100.0","inte":"false","property":"payload","x":760,"y":1340,"wires":[["2da6bee0.3b6252","61c9ba7.88c4b44"]]},{"id":"2da6bee0.3b6252","type":"function","z":"42adf1ec.1a792","name":"pecas - ok ou rep","func":"const maq = global.get('tse_var_maq')\n\nlet random = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).ligado === true && global.get(maq[i]).rodando === true && global.get(maq[i]).falha === false && global.get(maq[i]).manutencao === false){\n        \n        if(random >= 2.0 * flow.get(\"tse_pcs_fat_rand\")){\n        \n            global.get(maq[i]).pecas_ok = global.get(maq[i]).pecas_ok + 1\n        \n        }else{\n        \n            global.get(maq[i]).pecas_rep = global.get(maq[i]).pecas_rep + 1\n            msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                            \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                            \" - peça reprovada\" + \" fator : \" + flow.get(\"tse_pcs_fat_rand\")\n            return msg\n        }\n        \n    }\n}\n/*\n//Debug\nmsg.payload = \"Ok = \" + global.get(maq[i]).pecas_ok +  \" - Reprovadas = \" + global.get(maq[i]).pecas_rep\n\nreturn msg\n*/","outputs":1,"noerr":0,"x":970,"y":1340,"wires":[["1a8db34e.884b2d","d45b7b9f.4f80e8"]]},{"id":"ca2968ae.76cd68","type":"function","z":"42adf1ec.1a792","name":"Maquina : ligada","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet cmd = msg.payload\nlet maq_sql = []\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(cmd === \"random\"){\n        \n        global.get(maq[i]).id_operador = \"auto\"\n        \n    }else if((cmd.split(\"_\"))[1] === \"oper\"){\n        \n        global.get(maq[i]).id_operador = flow.get(\"tse_id_oper\")\n        \n    }\n    \n    if(global.get(maq[sel_maq]).id_operador === null){\n    \n        return [null, {\"payload\" : \"Favor logar no sistema\"}]\n    }\n    \n    if(!global.get(maq[i]).ligado  && global.get(maq[i]).id_operador !== null){\n        \n        if((cmd === \"random\" && global.get(maq[i]).aux.rand_val_liga >= 10.0) || (cmd === \"ligar_oper\" && sel_maq === i)){\n            \n            global.get('ResetVarMaq')(i)\n            global.get(maq[i]).ligado = true\n            maq_sql.push(maq[i])\n            // msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n            //             \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n            //             \" - Ligado\"\n            // return msg\n        }\n    }else if(global.get(maq[i]).ligado  && global.get(maq[i]).id_operador !== null){\n        \n        if((cmd === \"random\" && global.get(maq[i]).aux.rand_val_liga < 10.0) || (cmd === \"desligar_oper\" && sel_maq === i)){\n        \n            global.get(maq[i]).ligado = false\n            maq_sql.push(maq[i])\n            // msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n            //             \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n            //             \" - Desligado\"\n            // return msg\n        }\n    }\n}\nif(maq_sql.length > 0){\n    return {\"payload\" : maq_sql}\n}","outputs":2,"noerr":0,"x":740,"y":220,"wires":[["ebc16b7b.3fc088","9119d80.1b8ab28"],["4e898908.ecdc88"]]},{"id":"7a27c59f.c64c1c","type":"random","z":"42adf1ec.1a792","name":"","low":"0","high":"100.0","inte":"false","property":"payload","x":260,"y":220,"wires":[["7385628a.150a8c"]]},{"id":"2c734539.ceecda","type":"inject","z":"42adf1ec.1a792","name":"(30min)","topic":"","payload":"true","payloadType":"bool","repeat":"1800","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":220,"wires":[["7a27c59f.c64c1c"]]},{"id":"ebc16b7b.3fc088","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":260,"wires":[]},{"id":"d6263823.52c4c8","type":"comment","z":"42adf1ec.1a792","name":"Maquina - ligada","info":"","x":80,"y":160,"wires":[]},{"id":"a3d1870.aa6ec78","type":"function","z":"42adf1ec.1a792","name":"Maquina : falha","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet cmd = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(cmd === \"random\"){\n        \n        global.get(maq[i]).id_operador = \"auto\"\n        \n    }else{\n        \n        global.get(maq[i]).id_operador = flow.get(\"tse_id_oper\")\n        \n    }\n    \n    if(global.get(maq[sel_maq]).id_operador === null && cmd != \"alm\"){\n    \n        return [null, {\"payload\" : \"Favor logar no sistema\"}]\n    }\n    \n    if(!global.get(maq[i]).falha){\n        \n        if(cmd === \"alm\" && global.get(maq[i]).str_alm != \"sem falhas\"){\n        \n            global.get(maq[i]).falha = true\n            msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n                        \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - com falha\"\n            return msg\n        }\n        \n    }else{\n        \n        if((cmd === \"random\" && global.get(maq[i]).aux.rand_val_falha >= 30.0) || cmd === \"reset_oper\"){\n        \n            global.get(maq[i]).falha = false\n            global.get(maq[i]).str_alm = \"sem falhas\"\n            msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n                        \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - sem falha\"\n            return msg\n        \n        }\n        \n    }\n}","outputs":2,"noerr":0,"x":740,"y":400,"wires":[["48a8cdd.f55eb34","7f3e3ec0.14d8d"],["4e898908.ecdc88"]]},{"id":"34e5ddd2.c84142","type":"random","z":"42adf1ec.1a792","name":"","low":"10","high":"100.0","inte":"false","property":"payload","x":260,"y":400,"wires":[["ff9b9975.8dd518"]]},{"id":"5e1390c2.3880a","type":"inject","z":"42adf1ec.1a792","name":"(5min)","topic":"","payload":"true","payloadType":"bool","repeat":"300","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":400,"wires":[["34e5ddd2.c84142"]]},{"id":"48a8cdd.f55eb34","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":440,"wires":[]},{"id":"7ac20a41.3bb414","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - falha","info":"","x":80,"y":340,"wires":[]},{"id":"54f1ef7.09ff81","type":"function","z":"42adf1ec.1a792","name":"Maquina : rodando","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet cmd = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if((cmd.split(\"_\"))[1] === \"auto\"){\n        global.get(maq[i]).id_operador = \"auto\"\n    }else if((cmd.split(\"_\"))[1] === \"oper\"){\n        global.get(maq[i]).id_operador = flow.get(\"tse_id_oper\")\n    }\n    \n    if(global.get(maq[sel_maq]).id_operador === null){\n        \n        return [null, {\"payload\" : \"Favor logar no sistema\"}]\n    }\n    \n    if((cmd === \"desligar_auto\" || cmd === \"desligar_oper\") && sel_maq === i){\n        \n        if(global.get(maq[i]).rodando && global.get(maq[i]).id_operador !== null){\n            \n            global.get(maq[i]).rodando = false\n            global.get(maq[i]).aux.amb_setor_temp_aux_fat_rand = global.get(maq[i]).analog.temp_set01.prm.fat_rand\n            global.get(maq[i]).aux.calc_maq_time_parada_ini = new Date()\n            msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n                            \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                            \" - parada\"\n            return msg\n            \n        }\n    }else if(((cmd === \"ligar_auto\" && global.get(maq[i]).aux.rand_val_rodando >= 30.0)|| cmd === \"ligar_oper\") && sel_maq === i){\n        \n        if(global.get(maq[i]).ligado && !global.get(maq[i]).falha && !global.get(maq[i]).motores.motor01.rodando && !global.get(maq[i]).motores.motor02.rodando && !global.get(maq[i]).rodando && global.get(maq[i]).id_operador !== null){\n        \n            global.get(maq[i]).rodando = true\n            global.get(maq[i]).aux.amb_setor_temp_aux_fat_rand = global.get(maq[i]).analog.temp_set01.prm.fat_rand\n            \n            if(!global.get(maq[i]).wo_ini){\n                \n                global.get(maq[i]).tempo_wo_total = new Date(0)\n                global.get(maq[i]).tempo_wo_parada = new Date(0)\n                global.get(maq[i]).tempo_maq_rodando = new Date(0)\n                global.get(maq[i]).tempo_maq_parada = new Date(0)\n                \n            }\n        \n            global.get(maq[i]).aux.calc_maq_time_rodando_ini = new Date()\n        \n            if(global.get(maq[i]).wo_ini){\n            \n                msg.payload =  \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n                                \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                                \" - rodando\"\n                return msg\n            }\n            \n        }\n    \n    }else if(cmd === \"atualizar_auto\"){\n        \n        if((!global.get(maq[i]).ligado || global.get(maq[i]).falha) && global.get(maq[i]).rodando){\n        \n            global.get(maq[i]).rodando = false\n            global.get(maq[i]).aux.amb_setor_temp_aux_fat_rand = global.get(maq[i]).analog.temp_set01.prm.fat_rand\n            global.get(maq[i]).aux.calc_maq_time_parada_ini = new Date()\n            msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n                            \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                            \" - parada\"\n            return msg\n            \n        }\n        \n    }\n}","outputs":2,"noerr":0,"x":750,"y":600,"wires":[["1a1ae22a.85532e"],["4e898908.ecdc88"]]},{"id":"27dd48b1.78ea38","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"ligar_auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":600,"wires":[["54f1ef7.09ff81"]]},{"id":"ad776b20.1ce0c8","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"desligar_auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":680,"wires":[["54f1ef7.09ff81"]]},{"id":"9f66302b.f947c","type":"function","z":"42adf1ec.1a792","name":"atualizar","func":"msg.payload = \"atualizar_auto\"\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":740,"wires":[["54f1ef7.09ff81"]]},{"id":"29e5b838.c00e98","type":"link in","z":"42adf1ec.1a792","name":"","links":["7f3e3ec0.14d8d","9119d80.1b8ab28"],"x":95,"y":740,"wires":[["9f66302b.f947c"]]},{"id":"9119d80.1b8ab28","type":"link out","z":"42adf1ec.1a792","name":"maq_ligada","links":["29e5b838.c00e98","657024e0.5dd71c","49c6e5f8.fb76fc","67bb7006.d7834"],"x":915,"y":220,"wires":[]},{"id":"7f3e3ec0.14d8d","type":"link out","z":"42adf1ec.1a792","name":"maq_falha","links":["29e5b838.c00e98","657024e0.5dd71c","49c6e5f8.fb76fc","67bb7006.d7834"],"x":915,"y":400,"wires":[]},{"id":"a46067cf.144078","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - rodando","info":"","x":90,"y":540,"wires":[]},{"id":"ef9ff2e.28fed1","type":"function","z":"42adf1ec.1a792","name":"Status - Maquina","func":"const maq = flow.get(\"tse_sel_maq\")[0]\n\n\nmsg.payload = \"--Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \"--\" +\n    \"\\nTimestamp : \" + new Date() +\n    \"\\nLigado : \" + global.get(maq).ligado +\n    \" \\nFalha : \" + global.get(maq).falha +\n    \" \\nRodando : \" + global.get(maq).rodando + \n    \" \\nManutenção : \" + global.get(maq).manutencao + \n    \" \\nBatch : \" + global.get(maq).batch + \n    \" \\nWO : \" + global.get(maq).wo + \n    \" \\nWO ini : \" + global.get(maq).wo_ini + \n    \" \\nWO fim : \" + global.get(maq).wo_fim +\n    \" \\nTS WO ini : \" + global.get(maq).ts_wo_ini +\n    \" \\nTS WO fim : \" + global.get(maq).ts_wo_fim +\n    \" \\nTempo wo total : \" + (\"00\" + global.get(maq).tempo_wo_total.getHours()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_wo_total.getMinutes()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_wo_total.getSeconds()).slice(-2) + \n    \" \\nTempo wo parada : \" + (\"00\" + global.get(maq).tempo_wo_parada.getHours()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_wo_parada.getMinutes()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_wo_parada.getSeconds()).slice(-2) + \n    \" \\nTempo maq rodando : \" + (\"00\" + global.get(maq).tempo_maq_rodando.getHours()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_maq_rodando.getMinutes()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_maq_rodando.getSeconds()).slice(-2) + \n    \" \\nTempo maq parada : \" + (\"00\" + global.get(maq).tempo_maq_parada.getHours()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_maq_parada.getMinutes()).slice(-2) + \":\" + (\"00\" + global.get(maq).tempo_maq_parada.getSeconds()).slice(-2) + \n    \" \\nPeças OK : \" + global.get(maq).pecas_ok + \n    \" \\nPeças rep : \" + global.get(maq).pecas_rep +\n    \" \\nQtd peças desejadas : \" + global.get(maq).wo_qtd_pcs\n    \nreturn msg;","outputs":1,"noerr":0,"x":1390,"y":200,"wires":[["2326566a.7d895a"]]},{"id":"190ff568.13619b","type":"inject","z":"42adf1ec.1a792","name":"status","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1210,"y":200,"wires":[["ef9ff2e.28fed1"]]},{"id":"2326566a.7d895a","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1610,"y":200,"wires":[]},{"id":"9d1d6064.7be03","type":"comment","z":"42adf1ec.1a792","name":"Verifica - Status Maquina","info":"","x":1250,"y":140,"wires":[]},{"id":"5b306a94.d909e4","type":"inject","z":"42adf1ec.1a792","name":"(10min)","topic":"","payload":"true","payloadType":"bool","repeat":"600","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":800,"wires":[["6ff5fb54.412f44"]]},{"id":"6ff5fb54.412f44","type":"random","z":"42adf1ec.1a792","name":"","low":"0","high":"100.0","inte":"false","property":"payload","x":240,"y":800,"wires":[["9e0862cc.d4148"]]},{"id":"4fd394f6.dc6afc","type":"function","z":"42adf1ec.1a792","name":"ligar_auto","func":"let cmd = msg.payload\n\n\nif(cmd === \"random\"){\n    \n    msg.payload = \"ligar_auto\"\n    return msg\n}","outputs":1,"noerr":0,"x":600,"y":800,"wires":[["54f1ef7.09ff81"]]},{"id":"e2906985.899bd8","type":"comment","z":"42adf1ec.1a792","name":"configuração","info":"","x":70,"y":20,"wires":[]},{"id":"3267d53f.1695ca","type":"function","z":"42adf1ec.1a792","name":"Configuração da Maquina","func":"/*Parâmetros da maquina*/\n    \n//Posição da lista da maquina existente\nconst maq = global.get('tse_var_maq')\n//Usuarios\nconst users =   [[\"Joaquim\", \"Pedro\", \"Zé\", \"Maria\", \"Joaquina\"],\n                    [\"Zézinho\", \"Joaquina\"],\n                    [\"Wagner\"],\n                    [\"Juliana\"],\n                    [\"Kauã\"],\n                    [\"Fernando\"]\n                ]\n//Quantidade de peças produzidas por WO\nconst qtd_pcs = [[1800, 12300, 15500, 3500, 7000, 25000],\n                    [1801, 12301, 15501, 3501, 7001, 25001],\n                    [1802, 12302, 15502, 3502, 7002, 25002],\n                    [1803, 12303, 15503, 3503, 7003, 25003],\n                    [1804, 12304, 15504, 3504, 7004, 25004],\n                    [1805, 12305, 15505, 3505, 7005, 25005]\n                ]   \n//Lista de Batch a serem randomizadas\nconst batch =   [[\"Produto01\", \"Produto02\", \"Produto03\", \"Produto04\", \"Produto05\", \"Produto06\"],\n                    [\"Produto11\", \"Produto12\", \"Produto13\", \"Produto14\", \"Produto15\", \"Produto16\"],\n                    [\"Produto21\", \"Produto22\", \"Produto23\", \"Produto24\", \"Produto25\", \"Produto26\"],\n                    [\"Produto31\", \"Produto32\", \"Produto33\", \"Produto34\", \"Produto35\", \"Produto36\"],\n                    [\"Produto41\", \"Produto42\", \"Produto43\", \"Produto44\", \"Produto45\", \"Produto46\"],\n                    [\"Produto51\", \"Produto52\", \"Produto53\", \"Produto54\", \"Produto55\", \"Produto56\"],\n                ]\n//ICT\nconst ict =     [120,\n                    120,\n                    130,\n                    140,\n                    150,\n                    160\n                ]\n\n/*motores*/\n//Id modtores -*colocar em lista*- [\"motor01\", \"motor02\", ....]\n//obs.: não alterar os 2 primeiros motores\nconst id_mot =  [[\"motor01\", \"motor02\"],\n                    [\"motor01\", \"motor02\"],\n                    [\"motor01\", \"motor02\"],\n                    [\"motor01\", \"motor02\"],\n                    [\"motor01\", \"motor02\"],\n                    [\"motor01\", \"motor02\"]\n                ]\n\n/*motores/parametros*/\n//Corrente\nconst prm_corr =    [[39.1, 20.6],\n                        [39.1, 20.6],\n                        [39.1, 20.6],\n                        [39.1, 20.6],\n                        [39.1, 20.6],\n                        [39.1, 20.6]\n                    ]\n//Potência\nconst prm_pot =     [[15, 7.5],\n                        [15, 7.5],\n                        [15, 7.5],\n                        [15, 7.5],\n                        [15, 7.5],\n                        [15, 7.5]\n                    ]\n//Rampa de aceleração\nconst prm_ramp_acel =   [[15, 15],\n                            [15, 15],\n                            [15, 15],\n                            [15, 15],\n                            [15, 15],\n                            [15, 15]\n                        ]\n//Rampa de desaceleração\nconst prm_ramp_desacel =    [[20, 20],\n                                [20, 20],\n                                [20, 20],\n                                [20, 20],\n                                [20, 20],\n                                [20, 20]\n                            ]\n//Alarme de corrente (% acima da corrente configurada em prm_corr\nconst prm_alm_corr_hh =     [[30, 30],\n                                [30, 30],\n                                [30, 30],\n                                [30, 30],\n                                [30, 30],\n                                [30, 30]\n                            ]\n//Fator de randomização\n//Obs.: Nos motores [\"motor01\", \"motor02\"] não influência pois este valor é manipudado na lógica de erro\nconst prm_mot_fat_rand =    [[1, 1],\n                                [1, 1],\n                                [1, 1],\n                                [1, 1],\n                                [1, 1],\n                                [1, 1]\n                            ]\n\n/*analog*/\n//Id instrumentos analogicos -*colocar em lista*- [\"temp_set01\", \"umid_set01\", \"temp_ext01\", \"umid_ext01\", ....]\n//obs.: não alterar os 4 primeiros instrumentos\nconst id_analog =   [[\"temp_set01\", \"umid_set01\", \"temp_ext01\", \"umid_ext01\"],\n                        [\"temp_set01\", \"umid_set01\", \"temp_ext01\", \"umid_ext01\"],\n                        [\"temp_set01\", \"umid_set01\", \"temp_ext01\", \"umid_ext01\"],\n                        [\"temp_set01\", \"umid_set01\", \"temp_ext01\", \"umid_ext01\"],\n                        [\"temp_set01\", \"umid_set01\", \"temp_ext01\", \"umid_ext01\"],\n                        [\"temp_set01\", \"umid_set01\", \"temp_ext01\", \"umid_ext01\"]\n                    ]\n//Valores iniciais dos instrumentos\nconst val_ini_analog =  [[0,0,20,40],\n                            [0,0,21,41],\n                            [0,0,22,42],\n                            [0,0,23,43],\n                            [0,0,24,44],\n                            [0,0,25,45]\n                        ]\n//Unidade de engenharia dos instrumentos analógicos\nconst ue_analog =   [[\"°C\", \"%\", \"°C\", \"%\"],\n                        [\"°C\", \"%\", \"°C\", \"%\"],\n                        [\"°C\", \"%\", \"°C\", \"%\"],\n                        [\"°C\", \"%\", \"°C\", \"%\"],\n                        [\"°C\", \"%\", \"°C\", \"%\"],\n                        [\"°C\", \"%\", \"°C\", \"%\"]\n                    ]\n//Escala máxima do instrumento\nconst escala_max_analog =   [[100, 100, 100, 100],\n                                [100, 100, 100, 100],\n                                [100, 100, 100, 100],\n                                [100, 100, 100, 100],\n                                [100, 100, 100, 100],\n                                [100, 100, 100, 100]\n                            ]\n//Alarme HH\nconst alm_hh_analog =   [[35, 75, 40, 85],\n                            [35, 75, 40, 85],\n                            [35, 75, 40, 85],\n                            [35, 75, 40, 85],\n                            [35, 75, 40, 85],\n                            [35, 75, 40, 85]\n                        ]\n//Alarme LL\nconst alm_ll_analog =   [[5, 0, 10, 0],\n                            [5, 0, 10, 0],\n                            [5, 0, 10, 0],\n                            [5, 0, 10, 0],\n                            [5, 0, 10, 0],\n                            [5, 0, 10, 0]\n                        ]\n//Alarme HH enable\nconst alm_hh_enable_analog =    [[true, true, true, true],\n                                    [true, true, true, true],\n                                    [true, true, true, true],\n                                    [true, true, true, true],\n                                    [true, true, true, true],\n                                    [true, true, true, true]\n                                ]\n//Alarme LL enable\nconst alm_ll_enable_analog =    [[true, false, true, false],\n                                    [true, false, true, false],\n                                    [true, false, true, false],\n                                    [true, false, true, false],\n                                    [true, false, true, false],\n                                    [true, false, true, false]\n                                ]\n//Fator de randomização\n//Obs.: Nos analógicos [\"temp_set01\",\"temp_ext01\", \"umid_ext01\"] não influência pois este valor é manipudado na lógica de erro / API Clima Tempo\nconst prm_analog_fat_rand =     [[1, 1, 1, 1],\n                                    [1, 1, 1, 1],\n                                    [1, 1, 1, 1],\n                                    [1, 1, 1, 1],\n                                    [1, 1, 1, 1],\n                                    [1, 1, 1, 1]\n                                ]\n\n//4 primeiros instrumentos analógicos\n//ambiente\n//setor01\n\n//temperatura\n //Diferença entre temperatura externa via API para setor\nconst delta_temp =  [20,\n                        21,\n                        22,\n                        23,\n                        24,\n                        25\n                    ]\n //Temperatura de trabalho ideal\nconst trab_temp =   [23,\n                        23,\n                        23,\n                        23,\n                        23,\n                        23\n                    ]\n //Alarme de temperatura (% acima da temperatura configurada)\nconst alm_temp =    [20,\n                        20,\n                        20,\n                        20,\n                        20,\n                        20\n                    ]\n\n//umidade\n //Diferença entre umidade externa via API para setor\nconst delta_umid =  [20,\n                        25,\n                        30,\n                        35,\n                        40,\n                        45\n                    ]\n //Umidade de trabalho ideal\nconst trab_umid =   [40,\n                        40,\n                        40,\n                        40,\n                        40,\n                        40\n                    ]\n //Alarme de umidade (% acima da umidade configurada)\nconst alm_umid =    [60,\n                        60,\n                        60,\n                        60,\n                        60,\n                        60\n                    ]\n\n\n/*NÃO ALTERAR DAQUI PARA BAIXO*/\n\n//variáveis\n//flow.set(\"tse_sel_maq\", [global.get('tse_var_maq')[maq], maq])\nflow.set(\"tse_sel_maq\", [global.get('tse_var_maq')[0], 0])\n\n\n\nflow.set(\"tse_users\", users[0])\nflow.set(\"tse_sel_batch\", batch[0])\nflow.set(\"tse_sel_qtd\", qtd_pcs[0])\nflow.set(\"tse_amb_setor_temp_delta\", (1 - (delta_temp[0] /100)))\nflow.set(\"tse_amb_setor_temp_trab\", trab_temp[0])\nflow.set(\"tse_amb_setor_temp_alm\", flow.get(\"tse_amb_setor_temp_trab\") * ((alm_temp[0] /100) + 1))\nflow.set(\"tse_amb_setor_umid_delta\", (1 - (delta_umid[0] /100)))\nflow.set(\"tse_amb_setor_umid_trab\", trab_umid[0])\nflow.set(\"tse_amb_setor_umid_alm\", flow.get(\"tse_amb_setor_umid_trab\") * ((alm_umid[0] /100) + 1))\n\n\n\nfor(var i=0; i < maq.length ; i++){\n\n    //Parâmetros\n    global.get(maq[i]).ict = ict[i]\n    global.get(maq[i]).prm.users = users[i]\n    global.get(maq[i]).prm.batch = batch[i]\n    global.get(maq[i]).prm.qtd_pcs = qtd_pcs[i]\n    global.get(maq[i]).prm.amb_setor_temp_delta = (1 - (delta_temp[i] /100))\n    global.get(maq[i]).prm.amb_setor_temp_trab = trab_temp[i]\n    global.get(maq[i]).prm.amb_setor_temp_alm = global.get(maq[i]).prm.amb_setor_temp_trab * ((alm_temp[i] /100) + 1)\n    global.get(maq[i]).prm.amb_setor_umid_delta = (1 - (delta_umid[i] /100))\n    global.get(maq[i]).prm.amb_setor_umid_trab = trab_umid[i]\n    global.get(maq[i]).prm.amb_setor_umid_alm = global.get(maq[i]).prm.amb_setor_umid_trab * ((alm_umid[i] /100) + 1)\n    \n    //adiciona dinamicamente os motores\n    for(let j=0; j < id_mot[i].length ; j++){\n     \n        global.get(maq[i]).motores[id_mot[i][j]] = new context.global.tse_simu_motor_online()\n        global.get(maq[i]).motores[id_mot[i][j]].id = id_mot[i][j]\n        global.get(maq[i]).motores[id_mot[i][j]].prm.corrente = prm_corr[i][j]\n        global.get(maq[i]).motores[id_mot[i][j]].prm.potencia = prm_pot[i][j]\n        global.get(maq[i]).motores[id_mot[i][j]].prm.ramp_acel = prm_ramp_acel[i][j]\n        global.get(maq[i]).motores[id_mot[i][j]].prm.ramp_desacel = prm_ramp_desacel[i][j]\n        global.get(maq[i]).motores[id_mot[i][j]].prm.alm_corr_hh = prm_alm_corr_hh[i][j]\n        global.get(maq[i]).motores[id_mot[i][j]].prm.fat_rand = prm_mot_fat_rand[i][j]\n        global.get(maq[i]).motores[id_mot[i][j]].aux.fat_alm_corr_hh = global.get(maq[i]).motores[id_mot[i][j]].prm.corrente = prm_corr[i][j] * ((global.get(maq[i]).motores[id_mot[i][j]].prm.alm_corr_hh / 100) + 1)\n        \n    }\n    \n    //adiciona dinamicamente os instrumentos analógicos\n    for(let k=0; k < id_analog[i].length ; k++){\n    \n        global.get(maq[i]).analog[id_analog[i][k]] = new context.global.tse_simu_analog_online()\n        global.get(maq[i]).analog[id_analog[i][k]].id = id_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].value = val_ini_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].ue = ue_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].prm.escala_max = escala_max_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].prm.alm_hh = alm_hh_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].prm.alm_ll = alm_ll_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].prm.alm_hh_enable = alm_hh_enable_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].prm.alm_ll_enable = alm_ll_enable_analog[i][k]\n        global.get(maq[i]).analog[id_analog[i][k]].prm.fat_rand = prm_analog_fat_rand[i][k]\n        \n    }\n}","outputs":1,"noerr":0,"x":390,"y":80,"wires":[[]]},{"id":"15f1358a.f7d14a","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":80,"wires":[["3267d53f.1695ca","f81e93f8.49b5b","953ba71a.c09b78"]]},{"id":"58d5d40b.cecd4c","type":"inject","z":"90565ab.23a4fa8","name":"Linha 01 - Maq02","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":140,"wires":[["f30197d7.ae0748"]]},{"id":"7a49ed85.845034","type":"inject","z":"90565ab.23a4fa8","name":"Linha 01 - Maq03","topic":"","payload":"2","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":180,"wires":[["f30197d7.ae0748"]]},{"id":"b6bbced.4bd873","type":"inject","z":"90565ab.23a4fa8","name":"Linha 02 - Maq01","topic":"","payload":"3","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":220,"wires":[["f30197d7.ae0748"]]},{"id":"799df1e3.24ba1","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - pecas ok / rep","info":"","x":110,"y":1220,"wires":[]},{"id":"d673df79.614ae","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - manutenção","info":"","x":100,"y":860,"wires":[]},{"id":"eddbf9ff.72f5a8","type":"function","z":"42adf1ec.1a792","name":"Maquina : manutenção","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet cmd = msg.payload\n\n    \nif((cmd.split(\"_\"))[1] === \"auto\"){\n    global.get(maq[sel_maq]).id_operador = \"auto\"\n}else if((cmd.split(\"_\"))[1] === \"oper\"){\n    global.get(maq[sel_maq]).id_operador = flow.get(\"tse_id_oper\")\n}\n\nif(cmd === \"desligar_auto\" || cmd === \"desligar_oper\"){\n    \n    if(global.get(maq[sel_maq]).id_operador !== null){\n        global.get(maq[sel_maq]).manutencao = false\n        msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) + \n                        \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - fora da manutenção\"\n        return msg\n    }\n}else if(cmd === \"ligar_auto\" || cmd === \"ligar_oper\"){\n    \n    if(global.get(maq[sel_maq]).id_operador !== null){\n        global.get(maq[sel_maq]).manutencao = true\n        msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - em manutenção\"\n        return msg\n    }\n}\n\nif(global.get(maq[sel_maq]).id_operador === null){\n    \n    return [null, {\"payload\" : \"Favor logar no sistema\"}]\n}","outputs":2,"noerr":0,"x":760,"y":920,"wires":[["1d2766af.e1c3e9","df8735c0.36f038"],["4e898908.ecdc88"]]},{"id":"ae1bff5a.12a8a","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"ligar_auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":920,"wires":[["eddbf9ff.72f5a8"]]},{"id":"e443c94f.239878","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"desligar_auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":960,"wires":[["eddbf9ff.72f5a8"]]},{"id":"1d2766af.e1c3e9","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":880,"wires":[]},{"id":"4dbfff9a.6511","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - WO","info":"","x":70,"y":1060,"wires":[]},{"id":"3e80ef4.05c681","type":"function","z":"42adf1ec.1a792","name":"Maquina : WO_ini / WO_fim","func":"const maq = global.get('tse_var_maq')\nconst max_random = 100\n\nlet sel_batch = []\nlet sel_qtd = []\nlet sel_prod = 0\nlet date = new Date()\n\nfor(var i=0; i < maq.length ; i++){\n    \n    sel_batch = global.get(maq[i]).prm.batch\n    sel_qtd = global.get(maq[i]).prm.qtd_pcs\n    sel_prod = 0\n    \n    //wo_ini\n    if(global.get(maq[i]).ligado === true && global.get(maq[i]).rodando === true && global.get(maq[i]).wo_ini === false){\n        \n        global.get(maq[i]).wo_fim = false\n        global.get(maq[i]).batch = \"\"\n        global.get(maq[i]).wo = \"\"\n        global.get(maq[i]).ts_wo_ini = new Date()\n        global.get(maq[i]).ts_wo_fim = null\n        global.get(maq[i]).aux.calc_wo_time_parada_aux2 = new Date(0)\n        sel_prod = max_random / sel_batch.length\n        \n        for(var j=0; j < sel_batch.length ; j++){\n            \n    \t\tif(global.get(maq[i]).aux.rand_val_wo >= (sel_prod - (sel_prod / (j+1))) && global.get(maq[i]).aux.rand_val_wo < sel_prod && global.get(maq[i]).wo_ini === false){\n    \t\t    \n    \t\t    global.get(maq[i]).batch = sel_batch[j]\n    \t\t    global.get(maq[i]).wo_qtd_pcs = sel_qtd[j]\n    \t\t    global.get(maq[i]).wo = global.get('GeraWO')(date, -3, i)\n    \t\t    global.get(maq[i]).wo_ini = true\n    \t\t    global.get(maq[i]).pecas_ok = 0\n    \t\t    global.get(maq[i]).pecas_rep = 0\n    \t\t    \n    \t\t}\n    \t\tsel_prod = sel_prod + sel_prod\n    \t\t\n        }\n        msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - WO iniciada\"\n        return msg\n    }\n    \n    //wo_fim\n    if((global.get(maq[i]).ligado === false || global.get(maq[i]).manutencao === true || global.get(maq[i]).pecas_ok >= global.get(maq[i]).wo_qtd_pcs) && global.get(maq[i]).wo_ini === true){\n        \n        global.get(maq[i]).wo_ini = false\n        global.get(maq[i]).wo_fim = true\n        global.get(maq[i]).ts_wo_fim = new Date()\n        global.get(maq[i]).rodando = false\n        \n        msg.payload = \"-Linha\" + (\"00\" + (global.get('tse_simu_n_linha')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - Maquina\" + (\"00\" + (global.get('tse_simu_n_maq')[flow.get(\"tse_sel_maq\")[1]])).slice(-2) +\n                        \" - WO finalizada\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":780,"y":1120,"wires":[["fcaf1a2.98c95e8","d3a58c0d.249ec"]]},{"id":"d35e5316.ffce5","type":"inject","z":"42adf1ec.1a792","name":"(1seg)","topic":"","payload":"true","payloadType":"bool","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":1120,"wires":[["ac892de8.58b18"]]},{"id":"ac892de8.58b18","type":"random","z":"42adf1ec.1a792","name":"","low":"0","high":"100.0","inte":"false","property":"payload","x":280,"y":1120,"wires":[["f6d9a6d7.132518"]]},{"id":"1a1ae22a.85532e","type":"link out","z":"42adf1ec.1a792","name":"maq_rodando","links":["657024e0.5dd71c","7914679d.44c038","49c6e5f8.fb76fc","67bb7006.d7834"],"x":915,"y":600,"wires":[]},{"id":"df8735c0.36f038","type":"link out","z":"42adf1ec.1a792","name":"maq_manut","links":["657024e0.5dd71c","49c6e5f8.fb76fc","67bb7006.d7834"],"x":915,"y":920,"wires":[]},{"id":"d3a58c0d.249ec","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":1160,"wires":[]},{"id":"fcaf1a2.98c95e8","type":"link out","z":"42adf1ec.1a792","name":"maq_wo","links":["657024e0.5dd71c","49c6e5f8.fb76fc","67bb7006.d7834"],"x":955,"y":1120,"wires":[]},{"id":"657024e0.5dd71c","type":"link in","z":"42adf1ec.1a792","name":"","links":["1a1ae22a.85532e","7f3e3ec0.14d8d","9119d80.1b8ab28","df8735c0.36f038","fcaf1a2.98c95e8"],"x":1235,"y":240,"wires":[["ef9ff2e.28fed1"]]},{"id":"f90c35cf.c9ce48","type":"inject","z":"42adf1ec.1a792","name":"objeto","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1210,"y":340,"wires":[["ad4aacff.c632d"]]},{"id":"ad4aacff.c632d","type":"function","z":"42adf1ec.1a792","name":"Objeto - Maquina","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nmsg.payload = global.get(maq[sel_maq])\nreturn msg;","outputs":1,"noerr":0,"x":1390,"y":340,"wires":[["d38a3b0f.c58628"]]},{"id":"d38a3b0f.c58628","type":"debug","z":"42adf1ec.1a792","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1610,"y":340,"wires":[]},{"id":"9a04205.d0841e","type":"function","z":"42adf1ec.1a792","name":"motor01 - rodando","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === true && global.get(maq[i]).motores.motor01.rodando === false){\n        \n        global.get(maq[i]).motores.motor01.rodando = true\n            \n        msg.payload = \"true\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":670,"y":1820,"wires":[["1340e8c2.31cc77"]]},{"id":"84c73166.f1458","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - motores","info":"","x":90,"y":1760,"wires":[]},{"id":"bf505761.9334f8","type":"function","z":"42adf1ec.1a792","name":"maq = ligada","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === true && global.get(maq[i]).motores.motor01.rodando === false){\n        \n        msg.payload = \"true\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":290,"y":1820,"wires":[["e08ef922.dc1f68"]]},{"id":"e08ef922.dc1f68","type":"delay","z":"42adf1ec.1a792","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":1820,"wires":[["9a04205.d0841e"]]},{"id":"1340e8c2.31cc77","type":"delay","z":"42adf1ec.1a792","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":1820,"wires":[["42202675.579c78"]]},{"id":"42202675.579c78","type":"function","z":"42adf1ec.1a792","name":"motor02 - rodando","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === true && global.get(maq[i]).motores.motor01.rodando === true && global.get(maq[i]).motores.motor02.rodando === false){\n        \n        global.get(maq[i]).motores.motor02.rodando = true\n            \n        msg.payload = \"true\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":1070,"y":1820,"wires":[["98df7ef0.f1f83"]]},{"id":"a9e1f263.40ee","type":"function","z":"42adf1ec.1a792","name":"maq = desligada","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === false && global.get(maq[i]).motores.motor02.rodando === true){\n        \n        msg.payload = \"false\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":300,"y":1880,"wires":[["b10920ab.507f3"]]},{"id":"b10920ab.507f3","type":"delay","z":"42adf1ec.1a792","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":1880,"wires":[["afddbbba.cb7bf8"]]},{"id":"afddbbba.cb7bf8","type":"function","z":"42adf1ec.1a792","name":"motor02 - parado","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === false && global.get(maq[i]).motores.motor02.rodando === true){\n        \n        global.get(maq[i]).motores.motor02.rodando = false\n            \n        msg.payload = \"false\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":670,"y":1880,"wires":[["adec8984.022878"]]},{"id":"adec8984.022878","type":"delay","z":"42adf1ec.1a792","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":1880,"wires":[["76d8c6ea.5d12f8"]]},{"id":"76d8c6ea.5d12f8","type":"function","z":"42adf1ec.1a792","name":"motor01 - parado","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === false && global.get(maq[i]).motores.motor02.rodando === false && global.get(maq[i]).motores.motor01.rodando === true){\n        \n        global.get(maq[i]).motores.motor01.rodando = false\n            \n        msg.payload = \"false\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":1070,"y":1880,"wires":[["8fc84353.74d83"]]},{"id":"64fface6.f1a2e4","type":"function","z":"42adf1ec.1a792","name":"motor01 - analógicos","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    //rampa de aceleração\n    if(global.get(maq[i]).motores.motor01.rodando === true){\n        \n        global.get(maq[i]).motores.motor01.aux.desacel_ok = false\n        if(!global.get(maq[i]).motores.motor01.aux.acel_ok){\n            \n            global.get(maq[i]).motores.motor01.corrente = parseFloat((global.get(maq[i]).motores.motor01.corrente + (global.get(maq[i]).motores.motor01.prm.corrente /  global.get(maq[i]).motores.motor01.prm.ramp_acel)).toFixed(2))\n            global.get(maq[i]).motores.motor01.potencia = parseFloat((global.get(maq[i]).motores.motor01.potencia + (global.get(maq[i]).motores.motor01.prm.potencia /  global.get(maq[i]).motores.motor01.prm.ramp_acel)).toFixed(2))\n            global.get(maq[i]).motores.motor01.torque = parseFloat((global.get(maq[i]).motores.motor01.torque + (100 /  global.get(maq[i]).motores.motor01.prm.ramp_acel)).toFixed(2))\n            global.get(maq[i]).motores.motor01.aux.acel_calc = global.get(maq[i]).motores.motor01.aux.acel_calc + 1\n            \n        }\n        \n        if(global.get(maq[i]).motores.motor01.aux.acel_calc >= global.get(maq[i]).motores.motor01.prm.ramp_acel){\n            \n            global.get(maq[i]).motores.motor01.aux.acel_ok = true\n            global.get(maq[i]).motores.motor01.aux.acel_calc = 0\n            \n        }\n        \n    }\n    \n    //rampa de desaceleração\n    if(global.get(maq[i]).motores.motor01.rodando === false){\n        \n        global.get(maq[i]).motores.motor01.aux.acel_ok = false\n        if(!global.get(maq[i]).motores.motor01.aux.desacel_ok){\n            \n            global.get(maq[i]).motores.motor01.corrente = parseFloat((global.get(maq[i]).motores.motor01.corrente - (global.get(maq[i]).motores.motor01.prm.corrente /  global.get(maq[i]).motores.motor01.prm.ramp_desacel)).toFixed(2))\n            global.get(maq[i]).motores.motor01.potencia = parseFloat((global.get(maq[i]).motores.motor01.potencia - (global.get(maq[i]).motores.motor01.prm.potencia /  global.get(maq[i]).motores.motor01.prm.ramp_desacel)).toFixed(2))\n            global.get(maq[i]).motores.motor01.torque = parseFloat((global.get(maq[i]).motores.motor01.torque - (100 /  global.get(maq[i]).motores.motor01.prm.ramp_desacel)).toFixed(2))\n            global.get(maq[i]).motores.motor01.aux.desacel_calc = global.get(maq[i]).motores.motor01.aux.desacel_calc + 1\n            \n            if(global.get(maq[i]).motores.motor01.corrente <= 0){\n                \n                global.get(maq[i]).motores.motor01.corrente = 0\n            }\n            if(global.get(maq[i]).motores.motor01.potencia <= 0){\n                \n                global.get(maq[i]).motores.motor01.potencia = 0\n            }\n            if(global.get(maq[i]).motores.motor01.torque <= 0){\n                \n                global.get(maq[i]).motores.motor01.torque = 0\n            }\n        }\n        \n        if(global.get(maq[i]).motores.motor01.aux.desacel_calc >= global.get(maq[i]).motores.motor01.prm.ramp_desacel){\n            \n            global.get(maq[i]).motores.motor01.aux.desacel_ok = true\n            global.get(maq[i]).motores.motor01.aux.desacel_calc = 0\n            global.get(maq[i]).motores.motor01.corrente = 0\n            global.get(maq[i]).motores.motor01.potencia = 0\n            global.get(maq[i]).motores.motor01.torque = 0\n            \n        }\n        \n    }\n    \n    if(global.get(maq[i]).motores.motor01.aux.acel_ok === true){\n        \n        msg.payload = \"random\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":320,"y":1940,"wires":[["402902f5.76fc5c"]]},{"id":"9ef10230.7d43c","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":1820,"wires":[["64fface6.f1a2e4","bf505761.9334f8","a9e1f263.40ee","154561c5.64cb2e","a58513b1.5c804"]]},{"id":"402902f5.76fc5c","type":"random","z":"42adf1ec.1a792","name":"","low":"0.7","high":"0.9","inte":"false","property":"payload","x":540,"y":1940,"wires":[["c031d216.f9e31"]]},{"id":"c031d216.f9e31","type":"function","z":"42adf1ec.1a792","name":"motor01 - analógicos random","func":"const maq = global.get('tse_var_maq')\n\nlet random = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).motores.motor01.aux.acel_ok === true){\n        \n        global.get(maq[i]).motores.motor01.corrente = parseFloat((global.get(maq[i]).motores.motor01.prm.corrente * (random * global.get(maq[i]).motores.motor01.prm.fat_rand)).toFixed(2))\n        global.get(maq[i]).motores.motor01.potencia = parseFloat((global.get(maq[i]).motores.motor01.prm.potencia * (random * global.get(maq[i]).motores.motor01.prm.fat_rand)).toFixed(2))\n        global.get(maq[i]).motores.motor01.torque = parseFloat((100 * (random * global.get(maq[i]).motores.motor01.prm.fat_rand)).toFixed(2))\n    }\n}","outputs":1,"noerr":0,"x":780,"y":1940,"wires":[[]]},{"id":"c3754e91.888e1","type":"random","z":"42adf1ec.1a792","name":"","low":"0.7","high":"0.9","inte":"false","property":"payload","x":540,"y":2000,"wires":[["8d8a646f.696be8"]]},{"id":"15f91ff0.02496","type":"ui_chart","z":"42adf1ec.1a792","name":"","group":"7b5a5e17.4d119","order":1,"width":10,"height":5,"label":"Motor01","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":560,"y":2720,"wires":[[]]},{"id":"c400a8e4.117438","type":"ui_chart","z":"42adf1ec.1a792","name":"","group":"7b5a5e17.4d119","order":2,"width":10,"height":5,"label":"Motor02","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":560,"y":2780,"wires":[[]]},{"id":"b3a25a56.cc2608","type":"function","z":"42adf1ec.1a792","name":"motor01 - trend","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet trend_cor = 0\nlet trend_pot = 0\nlet trend_tor = 0\n\n\ntrend_cor = {\"payload\" : global.get(maq[sel_maq]).motores.motor01.corrente, \"topic\" : \"Corrente\"}\ntrend_pot = {\"payload\" : global.get(maq[sel_maq]).motores.motor01.potencia, \"topic\" : \"Potencia\"}\ntrend_tor = {\"payload\" : global.get(maq[sel_maq]).motores.motor01.torque, \"topic\" : \"Torque\"}\n\nreturn [trend_cor, trend_pot, trend_tor]","outputs":3,"noerr":0,"x":280,"y":2720,"wires":[["15f91ff0.02496"],["15f91ff0.02496"],["15f91ff0.02496"]]},{"id":"1c9158f2.0a30c7","type":"function","z":"42adf1ec.1a792","name":"motor02 - trend","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet trend_cor = 0\nlet trend_pot = 0\nlet trend_tor = 0\n\n\ntrend_cor = {\"payload\" : global.get(maq[sel_maq]).motores.motor02.corrente, \"topic\" : \"Corrente\"}\ntrend_pot = {\"payload\" : global.get(maq[sel_maq]).motores.motor02.potencia, \"topic\" : \"Potencia\"}\ntrend_tor = {\"payload\" : global.get(maq[sel_maq]).motores.motor02.torque, \"topic\" : \"Torque\"}\n\nreturn [trend_cor, trend_pot, trend_tor]","outputs":3,"noerr":0,"x":280,"y":2780,"wires":[["c400a8e4.117438"],["c400a8e4.117438"],["c400a8e4.117438"]]},{"id":"ec50cd44.9c257","type":"http request","z":"42adf1ec.1a792","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"http://apiadvisor.climatempo.com.br/api/v1/weather/locale/3556/current?token=d50f27e797ed7a1e33db284ee0190211","tls":"","persist":false,"proxy":"","authType":"","x":310,"y":2280,"wires":[["7c4da407.31476c"]]},{"id":"5aa96c2.a144f94","type":"inject","z":"42adf1ec.1a792","name":"20min,","topic":"","payload":"true","payloadType":"bool","repeat":"1200","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2280,"wires":[["ec50cd44.9c257"]]},{"id":"db15f976.207a38","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - Ambiente ","info":"","x":90,"y":2100,"wires":[]},{"id":"f546c3c9.10685","type":"comment","z":"42adf1ec.1a792","name":"API - Clima tempo - (Clima atual vinhedo)","info":"","x":200,"y":2220,"wires":[]},{"id":"7c4da407.31476c","type":"json","z":"42adf1ec.1a792","name":"","property":"payload","action":"","pretty":false,"x":490,"y":2280,"wires":[["7c7f5cb2.0a10e4","dbee0837.3330d8"]]},{"id":"dbee0837.3330d8","type":"function","z":"42adf1ec.1a792","name":"Ambiente - Externo01","func":"const maq = global.get('tse_var_maq')\n\nlet api = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    //Clima Atual - Vinhedo\n    global.get(maq[i]).analog.temp_ext01.value = parseFloat((api.data.temperature).toFixed(2))\n    global.get(maq[i]).analog.umid_ext01.value = parseFloat((api.data.humidity).toFixed(2))\n}    ","outputs":1,"noerr":0,"x":700,"y":2280,"wires":[[]]},{"id":"db1b1bad.ca2b08","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - Ambiente - Externo01","info":"","x":150,"y":2160,"wires":[]},{"id":"d314512e.ee4c1","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - Ambiente - Setor01","info":"","x":140,"y":2340,"wires":[]},{"id":"9e08c91a.9779b8","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":2400,"wires":[["fc4436de.13cf38","8da031cd.98885"]]},{"id":"6127a982.cb0aa8","type":"function","z":"42adf1ec.1a792","name":"Ambiente - Setor01 - Temperatura","func":"const maq = global.get('tse_var_maq')\n\nlet random = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    //Clima Setor\n    global.get(maq[i]).analog.temp_set01.value = parseFloat(((global.get(maq[i]).analog.temp_ext01.value * global.get(maq[i]).prm.amb_setor_temp_delta) * (random * global.get(maq[i]).analog.temp_set01.prm.fat_rand)).toFixed(2))\n    \n    //msg.payload = \"Temperatura : \" + global.get(maq).analog.temp_set01.value\n    //msg.payload = flow.get(\"tse_amb_setor_temp_delta\")\n    //msg.payload = global.get(maq).analog.temp_set01.prm.fat_rand\n    //msg.payload = global.get(maq).analog.temp_set01.value\n    //return msg\n}","outputs":1,"noerr":0,"x":560,"y":2400,"wires":[["19cd3fdb.943f9"]]},{"id":"fc4436de.13cf38","type":"random","z":"42adf1ec.1a792","name":"","low":"0.95","high":"1","inte":"false","property":"payload","x":280,"y":2400,"wires":[["6127a982.cb0aa8"]]},{"id":"654b2fe6.2d949","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - Dashboard","info":"","x":100,"y":2520,"wires":[]},{"id":"fe65a302.8c7b3","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":2720,"wires":[["b3a25a56.cc2608","1c9158f2.0a30c7","82b9ade3.e8a23","10e48924.0f8927","2acd3641.844d4a","7ab82913.fcc8a8","4645ab52.684dd4"]]},{"id":"2a59d533.29df2a","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"d1566910.2139f8","order":1,"width":2,"height":2,"min":0,"max":10,"name":"Temperatura","icon":"fa-thermometer-half","label":"","unit":"ᵒC","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#ff9900","t":"min"},{"val":10,"col":"#ff9900","t":"max"}],"bgcolorFromTheme":true,"x":570,"y":2880,"wires":[]},{"id":"7ab82913.fcc8a8","type":"function","z":"42adf1ec.1a792","name":"Ambiente - Externo 01 - trend","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet trend_temp = 0\nlet trend_umid = 0\n\n\ntrend_temp = {\"payload\" : global.get(maq[sel_maq]).analog.temp_ext01.value, \"topic\" : \"Temperatura\"}\ntrend_umid = {\"payload\" : global.get(maq[sel_maq]).analog.umid_ext01.value, \"topic\" : \"Umidade\"}\n\nreturn [trend_temp, trend_umid]","outputs":2,"noerr":0,"x":320,"y":2900,"wires":[["2a59d533.29df2a","cef629a4.9ebc58"],["88070eea.262e7","aeb4e650.f181d8"]]},{"id":"88070eea.262e7","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"d1566910.2139f8","order":3,"width":2,"height":2,"min":0,"max":10,"name":"Umidade","icon":"fa-tint","label":"","unit":"%","layout":"radial","decimals":0,"differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#ff9900","t":"min"},{"val":10,"col":"#ff9900","t":"max"}],"bgcolorFromTheme":true,"x":560,"y":2920,"wires":[]},{"id":"cef629a4.9ebc58","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"d1566910.2139f8","order":5,"width":2,"height":1,"name":"Temperatura","label":"","blur":true,"minmax":false,"colorLine":"#ff2600","colorFromTheme":false,"stroke":2,"pointcount":"15","x":730,"y":2880,"wires":[]},{"id":"aeb4e650.f181d8","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"d1566910.2139f8","order":7,"width":2,"height":1,"name":"Umidade","label":"","blur":true,"minmax":false,"colorLine":"#31ff00","colorFromTheme":false,"stroke":2,"pointcount":"15","x":720,"y":2920,"wires":[]},{"id":"bc54bba6.761bf8","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"4b508bf3.e86d04","order":1,"width":2,"height":2,"min":0,"max":10,"name":"Temperatura","icon":"fa-thermometer-half","label":"","unit":"ᵒC","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#ff9900","t":"min"},{"val":10,"col":"#ff9900","t":"max"}],"bgcolorFromTheme":true,"x":570,"y":3000,"wires":[]},{"id":"4645ab52.684dd4","type":"function","z":"42adf1ec.1a792","name":"Ambiente - Setor 01 - trend","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet trend_temp = 0\nlet trend_umid = 0\n\n\ntrend_temp = {\"payload\" : global.get(maq[sel_maq]).analog.temp_set01.value, \"topic\" : \"Temperatura\"}\ntrend_umid = {\"payload\" : global.get(maq[sel_maq]).analog.umid_set01.value, \"topic\" : \"Umidade\"}\n\nreturn [trend_temp, trend_umid]","outputs":2,"noerr":0,"x":320,"y":3020,"wires":[["bc54bba6.761bf8","33d9ffb0.6b8ed"],["a25392b0.e3ab2","c65164af.f03188"]]},{"id":"a25392b0.e3ab2","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"4b508bf3.e86d04","order":3,"width":2,"height":2,"min":0,"max":10,"name":"Umidade","icon":"fa-tint","label":"","unit":"%","layout":"radial","decimals":0,"differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#ff9900","t":"min"},{"val":10,"col":"#ff9900","t":"max"}],"bgcolorFromTheme":true,"x":560,"y":3040,"wires":[]},{"id":"33d9ffb0.6b8ed","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"4b508bf3.e86d04","order":5,"width":2,"height":1,"name":"Temperatura","label":"","blur":true,"minmax":false,"colorLine":"#ff2600","colorFromTheme":false,"stroke":"2","pointcount":"15","x":730,"y":3000,"wires":[]},{"id":"c65164af.f03188","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"4b508bf3.e86d04","order":7,"width":2,"height":1,"name":"Umidade","label":"","blur":true,"minmax":false,"colorLine":"#31ff00","colorFromTheme":false,"stroke":2,"pointcount":"15","x":720,"y":3040,"wires":[]},{"id":"8da031cd.98885","type":"random","z":"42adf1ec.1a792","name":"","low":"0.95","high":"1","inte":"false","property":"payload","x":280,"y":2440,"wires":[["318c43c6.13c7bc"]]},{"id":"318c43c6.13c7bc","type":"function","z":"42adf1ec.1a792","name":"Ambiente - Setor01 - Umidade","func":"const maq = global.get('tse_var_maq')\n\nlet random = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    \n    //Clima Setor\n    global.get(maq[i]).analog.umid_set01.value = parseFloat(((global.get(maq[i]).analog.umid_ext01.value * global.get(maq[i]).prm.amb_setor_umid_delta) * (random * global.get(maq[i]).analog.umid_set01.prm.fat_rand)).toFixed(2))\n    \n    //msg.payload = \"Umidade : \" + global.get(maq).analog.umid_set01.value\n    //return msg\n}","outputs":1,"noerr":0,"x":550,"y":2440,"wires":[[]]},{"id":"f712c66d.51fb48","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - tempos de funcionamento","info":"","x":140,"y":1480,"wires":[]},{"id":"4dbe0a47.debb04","type":"function","z":"42adf1ec.1a792","name":"Maquina : wo rodando","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).wo_ini === true){\n        \n        global.get(maq[i]).tempo_wo_total = new Date((new Date()) - global.get(maq[i]).ts_wo_ini)\n        \n    }\n}","outputs":1,"noerr":0,"x":380,"y":1540,"wires":[[]]},{"id":"51109503.1dfdac","type":"inject","z":"42adf1ec.1a792","name":"(1seg)","topic":"","payload":"true","payloadType":"bool","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1540,"wires":[["4dbe0a47.debb04","2bba4012.68b6f","48ae02fe.55d9ac"]]},{"id":"2bba4012.68b6f","type":"function","z":"42adf1ec.1a792","name":"Maquina : wo parada","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).wo_ini === true && global.get(maq[i]).rodando === false){\n        \n        if(global.get(maq[i]).aux.calc_wo_time_parada_ini === 0){\n            \n            global.get(maq[i]).aux.calc_wo_time_parada_ini = new Date()\n            \n        }\n        \n        global.get(maq[i]).aux.calc_wo_time_parada_aux1 = new Date((new Date()) - global.get(maq[i]).aux.calc_wo_time_parada_ini)\n        global.get(maq[i]).tempo_wo_parada = new Date(global.get(maq[i]).aux.calc_wo_time_parada_aux1.getTime() + global.get(maq[i]).aux.calc_wo_time_parada_aux2.getTime())\n        \n    }else{\n        \n        global.get(maq[i]).aux.calc_wo_time_parada_ini = 0\n        global.get(maq[i]).aux.calc_wo_time_parada_aux2 = global.get(maq[i]).tempo_wo_parada\n        \n    }\n}","outputs":1,"noerr":0,"x":380,"y":1600,"wires":[[]]},{"id":"48ae02fe.55d9ac","type":"function","z":"42adf1ec.1a792","name":"Maquina : maquina rodando","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).rodando === true){\n        \n        global.get(maq[i]).tempo_maq_rodando = new Date((new Date()) - global.get(maq[i]).aux.calc_maq_time_rodando_ini)\n        global.get(maq[i]).tempo_maq_parada = new Date(0)\n        \n    }else{\n        \n        global.get(maq[i]).tempo_maq_parada = new Date((new Date()) - global.get(maq[i]).aux.calc_maq_time_parada_ini)\n        global.get(maq[i]).tempo_maq_rodando = new Date(0)\n        \n    }\n}","outputs":1,"noerr":0,"x":400,"y":1660,"wires":[[]]},{"id":"ad3eb5be.ecfa98","type":"inject","z":"42adf1ec.1a792","name":"(1seg)","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1660,"wires":[["48ae02fe.55d9ac"]]},{"id":"2274964a.f7ba8a","type":"link out","z":"90565ab.23a4fa8","name":"maq_inicializacao","links":["221537e8.4b6b18","7dfa24f8.e454bc","6b863716.e76f28","bbbf4132.29a95","e70fe5bb.c7cf88"],"x":215,"y":260,"wires":[]},{"id":"221537e8.4b6b18","type":"link in","z":"42adf1ec.1a792","name":"","links":["2274964a.f7ba8a"],"x":115,"y":120,"wires":[["3267d53f.1695ca","f81e93f8.49b5b"]]},{"id":"145c8e89.944f81","type":"ui_led","z":"42adf1ec.1a792","group":"fbe4baa6.8db5e8","order":1,"width":3,"height":1,"label":"Ligada","labelPlacement":"right","labelAlignment":"left","colorForValue":[{"color":"gray","value":"false","valueType":"bool"},{"color":"green","value":"true","valueType":"bool"}],"allowColorForValueInMessage":false,"name":"Ligada","x":470,"y":3140,"wires":[]},{"id":"82b9ade3.e8a23","type":"function","z":"42adf1ec.1a792","name":"Status","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet maq_ligada = {\"payload\" : false}\nlet maq_falha = {\"payload\" : false}\nlet maq_rodando = {\"payload\" : false}\nlet maq_manutencao = {\"payload\" : false}\nlet maq_wo_ini = {\"payload\" : false}\nlet maq_wo_fim = {\"payload\" : false}\n\n\nif(global.get(maq[sel_maq]).ligado === true){\n    maq_ligada.payload = true\n}\nif(global.get(maq[sel_maq]).falha === true){\n    maq_falha.payload = true\n}\nif(global.get(maq[sel_maq]).rodando === true){\n    maq_rodando.payload = true\n}\nif(global.get(maq[sel_maq]).manutencao === true){\n    maq_manutencao.payload = true\n}\nif(global.get(maq[sel_maq]).wo_ini === true){\n    maq_wo_ini.payload = true\n}\nif(global.get(maq[sel_maq]).wo_ini === true){\n    maq_wo_ini.payload = true\n}\nif(global.get(maq[sel_maq]).wo_fim === true){\n    maq_wo_fim.payload = true\n}\n\n\nreturn [maq_ligada, maq_falha, maq_rodando, maq_manutencao, maq_wo_ini, maq_wo_fim]","outputs":6,"noerr":0,"x":250,"y":3180,"wires":[["145c8e89.944f81"],["4973d6ec.7eb778"],["b9ab191.08f50e8"],["6aafd31b.f85a4c"],[],[]]},{"id":"4973d6ec.7eb778","type":"ui_led","z":"42adf1ec.1a792","group":"fbe4baa6.8db5e8","order":3,"width":3,"height":1,"label":"Falha","labelPlacement":"right","labelAlignment":"left","colorForValue":[{"color":"gray","value":"false","valueType":"bool"},{"color":"red","value":"true","valueType":"bool"}],"allowColorForValueInMessage":false,"name":"Falha","x":470,"y":3180,"wires":[]},{"id":"b9ab191.08f50e8","type":"ui_led","z":"42adf1ec.1a792","group":"fbe4baa6.8db5e8","order":5,"width":3,"height":1,"label":"Rodando","labelPlacement":"right","labelAlignment":"left","colorForValue":[{"color":"gray","value":"false","valueType":"bool"},{"color":"green","value":"true","valueType":"bool"}],"allowColorForValueInMessage":false,"name":"Rodando","x":480,"y":3220,"wires":[]},{"id":"6aafd31b.f85a4c","type":"ui_led","z":"42adf1ec.1a792","group":"fbe4baa6.8db5e8","order":7,"width":3,"height":1,"label":"Manutenção","labelPlacement":"right","labelAlignment":"left","colorForValue":[{"color":"gray","value":"false","valueType":"bool"},{"color":"red","value":"true","valueType":"bool"}],"allowColorForValueInMessage":false,"name":"Manutencao","x":490,"y":3260,"wires":[]},{"id":"3b1728af.2e7eb8","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":1,"width":5,"height":1,"name":"WO ","label":"WO :","format":"{{msg.payload}}","layout":"row-left","x":470,"y":3380,"wires":[]},{"id":"10e48924.0f8927","type":"function","z":"42adf1ec.1a792","name":"Status","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet maq_batch = {\"payload\" : global.get(maq[sel_maq]).batch}\nlet maq_wo = {\"payload\" : global.get(maq[sel_maq]).wo}\nlet maq_ts_wo_ini = {\"payload\" : global.get('StrDateTz')(global.get(maq[sel_maq]).ts_wo_ini, -3)}    \nlet maq_ts_wo_fim = {\"payload\" : global.get('StrDateTz')(global.get(maq[sel_maq]).ts_wo_fim, -3)}\nlet maq_temp_wo_total = {\"payload\" : global.get('StrDateToTime')(global.get(maq[sel_maq]).tempo_wo_total)}\nlet maq_temp_wo_parada = {\"payload\" : global.get('StrDateToTime')(global.get(maq[sel_maq]).tempo_wo_parada)}\nlet maq_temp_maq_rodando = {\"payload\" : global.get('StrDateToTime')(global.get(maq[sel_maq]).tempo_maq_rodando)}\nlet maq_temp_maq_parada = {\"payload\" : global.get('StrDateToTime')(global.get(maq[sel_maq]).tempo_maq_parada)}\nlet maq_pecas_ok = {\"payload\" : global.get(maq[sel_maq]).pecas_ok}\nlet maq_pecas_rep = {\"payload\" : global.get(maq[sel_maq]).pecas_rep}\nlet maq_qtd_pecas = {\"payload\" : global.get(maq[sel_maq]).wo_qtd_pcs + \" unid.\"}\nlet maq_str_alm = {\"payload\" : global.get(maq[sel_maq]).str_alm}\n\nreturn [maq_batch, maq_wo, maq_ts_wo_ini, maq_ts_wo_fim, maq_temp_wo_total, maq_temp_wo_parada, maq_temp_maq_rodando, maq_temp_maq_parada, maq_pecas_ok, maq_pecas_rep, maq_qtd_pecas, maq_str_alm]","outputs":12,"noerr":0,"x":250,"y":3540,"wires":[["40717a65.96a734"],["3b1728af.2e7eb8"],["330f7fea.9aaf2"],["b388db8e.87b7b8"],["e36c5377.4ffe8"],["3315d48b.b02fac"],["4eb704.cebcf8fc"],["4e6a82fb.15872c"],["988441ad.a8226"],["c0164a2e.31ae08"],["8d1321ab.74f98"],["99ceea1e.fde2b8"]]},{"id":"330f7fea.9aaf2","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":5,"width":5,"height":1,"name":"wo_ini","label":"Inicio :","format":"{{msg.payload}}","layout":"row-left","x":470,"y":3420,"wires":[]},{"id":"b388db8e.87b7b8","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":6,"width":5,"height":1,"name":"wo_fim","label":"Fim :","format":"{{msg.payload}}","layout":"row-left","x":480,"y":3460,"wires":[]},{"id":"e36c5377.4ffe8","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":7,"width":4,"height":1,"name":"tempo_wo_total","label":"Iniciado :","format":"{{msg.payload}}","layout":"row-left","x":500,"y":3500,"wires":[]},{"id":"3315d48b.b02fac","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":9,"width":4,"height":1,"name":"tempo_wo_parada","label":"Parado :","format":"{{msg.payload}}","layout":"row-left","x":510,"y":3540,"wires":[]},{"id":"4eb704.cebcf8fc","type":"ui_text","z":"42adf1ec.1a792","group":"fbe4baa6.8db5e8","order":9,"width":4,"height":1,"name":"tempo_maq_rodando","label":"Rodando :","format":"{{msg.payload}}","layout":"row-left","x":520,"y":3580,"wires":[]},{"id":"4e6a82fb.15872c","type":"ui_text","z":"42adf1ec.1a792","group":"fbe4baa6.8db5e8","order":11,"width":4,"height":1,"name":"tempo_maq_parada","label":"Parado :","format":"{{msg.payload}}","layout":"row-left","x":520,"y":3620,"wires":[]},{"id":"988441ad.a8226","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":11,"width":4,"height":1,"name":"pecas_ok","label":"Peças OK :","format":"{{msg.payload}}","layout":"row-left","x":480,"y":3660,"wires":[]},{"id":"c0164a2e.31ae08","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":13,"width":4,"height":1,"name":"pecas_rej","label":"Peças Rejeitadas :","format":"{{msg.payload}}","layout":"row-left","x":480,"y":3700,"wires":[]},{"id":"8d1321ab.74f98","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":3,"width":5,"height":1,"name":"qt_pecas","label":"Setpoint produção :","format":"{{msg.payload}}","layout":"row-left","x":480,"y":3740,"wires":[]},{"id":"40717a65.96a734","type":"ui_text","z":"42adf1ec.1a792","group":"69543932.98cd58","order":2,"width":5,"height":1,"name":"batch","label":"Batch :","format":"{{msg.payload}}","layout":"row-left","x":470,"y":3340,"wires":[]},{"id":"4359f6f2.8b2448","type":"ui_button","z":"42adf1ec.1a792","name":"","group":"94774b35.ea4148","order":8,"width":3,"height":1,"passthru":false,"label":"Rodar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"ligar_oper","payloadType":"str","topic":"","x":70,"y":600,"wires":[["54f1ef7.09ff81"]]},{"id":"639c3219.6b102c","type":"ui_button","z":"42adf1ec.1a792","name":"","group":"94774b35.ea4148","order":10,"width":3,"height":1,"passthru":false,"label":"Parar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"desligar_oper","payloadType":"str","topic":"","x":70,"y":680,"wires":[["54f1ef7.09ff81"]]},{"id":"4d2093dd.21c61c","type":"ui_switch","z":"42adf1ec.1a792","name":"","label":"Manutenção","tooltip":"","group":"94774b35.ea4148","order":6,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ligar_oper","onvalueType":"str","onicon":"","oncolor":"","offvalue":"desligar_oper","offvalueType":"str","officon":"","offcolor":"","x":370,"y":1000,"wires":[["eddbf9ff.72f5a8"]]},{"id":"d1006109.be7a1","type":"ui_switch","z":"42adf1ec.1a792","name":"","label":"Operação","tooltip":"","group":"94774b35.ea4148","order":4,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ligar_oper","onvalueType":"str","onicon":"","oncolor":"","offvalue":"desligar_oper","offvalueType":"str","officon":"","offcolor":"","x":440,"y":260,"wires":[["ca2968ae.76cd68"]]},{"id":"13d0759f.74dc8a","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"0.5","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1000,"wires":[["1ef646f2.62dea9"]]},{"id":"1ef646f2.62dea9","type":"function","z":"42adf1ec.1a792","name":"scan","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nif(global.get(maq[sel_maq]).manutencao){\n    return {\"payload\" : \"ligar_oper\"}\n}else{\n    return {\"payload\" : \"desligar_oper\"}\n} ","outputs":1,"noerr":0,"x":230,"y":1000,"wires":[["4d2093dd.21c61c"]]},{"id":"6b949a3a.813474","type":"function","z":"42adf1ec.1a792","name":"scan","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\n\nif(global.get(maq[sel_maq]).ligado){\n    return {\"payload\" : \"ligar_oper\"}\n}else{\n    return {\"payload\" : \"desligar_oper\"}\n} ","outputs":1,"noerr":0,"x":250,"y":260,"wires":[["d1006109.be7a1"]]},{"id":"303c0a23.37e1f6","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"0.5","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":260,"wires":[["6b949a3a.813474"]]},{"id":"927ade15.08264","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - Geração de erros / alarmes","info":"","x":150,"y":4160,"wires":[]},{"id":"f5cd1559.ca9c48","type":"function","z":"42adf1ec.1a792","name":"Erros","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    //Quanto mais tempo a maquina ficar rodando mais irá aumentar o fator da temperatura\n    if(global.get(maq[i]).rodando){\n        global.get(maq[i]).analog.temp_set01.prm.fat_rand = global.get(maq[i]).aux.amb_setor_temp_aux_fat_rand * (((global.get(maq[i]).tempo_maq_rodando.getMinutes() / 5 ) / 100) + 1)\n    }else{\n        if(global.get(maq[i]).analog.temp_set01.prm.fat_rand > 1){\n            global.get(maq[i]).analog.temp_set01.prm.fat_rand = global.get(maq[i]).aux.amb_setor_temp_aux_fat_rand * (1 - ((global.get(maq[i]).tempo_maq_parada.getMinutes() / 5 ) / 100))\n        }else{\n            global.get(maq[i]).analog.temp_set01.prm.fat_rand = 1\n        }\n    }\n    \n    //Caso a temperatura ultrapasse o valor de trabalho, aumenta os fatores dos motores \n    if(global.get(maq[i]).analog.temp_set01.value >= global.get(maq[i]).prm.amb_setor_temp_trab){\n        global.get(maq[i]).motores.motor01.prm.fat_rand = global.get(maq[i]).analog.temp_set01.prm.fat_rand\n        global.get(maq[i]).motores.motor02.prm.fat_rand = global.get(maq[i]).analog.temp_set01.prm.fat_rand\n    }else{\n        global.get(maq[i]).motores.motor01.prm.fat_rand = 1\n        global.get(maq[i]).motores.motor02.prm.fat_rand = 1\n    }\n    \n    \n    \n    //Caso a temperatura ultrapasse o valor de trabalho, aumenta o fator de erro de peças produzidas\n    \n    var fat_temp\n    var fat_umid\n    \n    if(global.get(maq[i]).analog.temp_set01.value >= global.get(maq[i]).prm.amb_setor_temp_trab){\n        fat_temp = 2\n    }else{\n        fat_temp = 1\n    }\n    \n    if(global.get(maq[i]).analog.umid_set01.value >= global.get(maq[i]).prm.amb_setor_umid_trab){\n        fat_umid = 3\n    }else{\n        fat_umid = 1\n    }\n    if(global.get(maq[i]).analog.temp_set01.valuea >= global.get(maq[i]).prm.amb_setor_temp_trab || global.get(maq[i]).analog.umid_set01.value >= global.get(maq[i]).prm.amb_setor_umid_trab){\n        global.get(maq[i]).aux.pcs_fat_rand = global.get(maq[i]).analog.temp_set01.prm.fat_rand * fat_temp * fat_umid\n    }else{\n        global.get(maq[i]).aux.pcs_fat_rand = 1\n    }\n    \n    msg.payload = global.get(maq[i]).aux.pcs_fat_rand\n    return msg\n}","outputs":1,"noerr":0,"x":310,"y":4220,"wires":[["db7d2b71.d57218"]]},{"id":"7aca9c16.df96c4","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":4220,"wires":[["f5cd1559.ca9c48","e2b2ea38.ac9908"]]},{"id":"9ab06641.79c878","type":"trigger","z":"42adf1ec.1a792","op1":"","op2":"2","op1type":"nul","op2type":"str","duration":"200","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":500,"y":1260,"wires":[["d07eb7f3.0362a8"]]},{"id":"d0154c1c.ddb6d","type":"inject","z":"42adf1ec.1a792","name":"ict=120 (500ms)","topic":"","payload":"tse_pcs_fat_rand","payloadType":"flow","repeat":"0.52","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1320,"wires":[["40517216.a8a8dc"]]},{"id":"40517216.a8a8dc","type":"switch","z":"42adf1ec.1a792","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"2","vt":"num"},{"t":"btwn","v":"2","vt":"num","v2":"3.99999","v2t":"num"},{"t":"btwn","v":"4","vt":"num","v2":"4.49999","v2t":"num"},{"t":"btwn","v":"4.5","vt":"num","v2":"5.99999","v2t":"num"},{"t":"btwn","v":"6","vt":"num","v2":"6.49999","v2t":"num"},{"t":"gte","v":"6.5","vt":"num"}],"checkall":"true","repair":false,"outputs":6,"x":290,"y":1320,"wires":[["d07eb7f3.0362a8"],["9ab06641.79c878"],["5da10d9c.6d5634"],["1d93ce01.a9eaf2"],["a12f7fc2.9a09"],["91bc0e5a.7007c"]]},{"id":"5da10d9c.6d5634","type":"trigger","z":"42adf1ec.1a792","op1":"","op2":"3","op1type":"nul","op2type":"str","duration":"400","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":500,"y":1300,"wires":[["d07eb7f3.0362a8"]]},{"id":"1d93ce01.a9eaf2","type":"trigger","z":"42adf1ec.1a792","op1":"","op2":"4","op1type":"nul","op2type":"str","duration":"600","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":500,"y":1340,"wires":[["d07eb7f3.0362a8"]]},{"id":"a12f7fc2.9a09","type":"trigger","z":"42adf1ec.1a792","op1":"","op2":"5","op1type":"nul","op2type":"str","duration":"1000","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":500,"y":1380,"wires":[["d07eb7f3.0362a8"]]},{"id":"91bc0e5a.7007c","type":"trigger","z":"42adf1ec.1a792","op1":"","op2":"6","op1type":"nul","op2type":"str","duration":"1200","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":500,"y":1420,"wires":[["d07eb7f3.0362a8"]]},{"id":"db7d2b71.d57218","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":520,"y":4220,"wires":[]},{"id":"e2b2ea38.ac9908","type":"function","z":"42adf1ec.1a792","name":"alarmes","func":"const maq = global.get('tse_var_maq')\n\nlet alm = false\n\nfor(var i=0; i < maq.length ; i++){\n\n    //Alarmes\n    \n    for(var mot in global.get(maq[i]).motores){\n        \n        if(global.get(maq[i]).motores[mot].corrente >= global.get(maq[i]).motores[mot].aux.fat_alm_corr_hh){\n            global.get(maq[i]).str_alm = \"Alarme de corrente alta \" + mot + \" - \" + (global.get(maq[i]).motores[mot].corrente).toFixed(2) + \"A - Limite : \" + (global.get(maq[i]).motores[mot].aux.fat_alm_corr_hh).toFixed(2) + \"A\"\n            alm = true\n        }\n    }\n    \n    for(var analog in global.get(maq[i]).analog){\n        \n        if(global.get(maq[i]).analog[analog].value >= global.get(maq[i]).analog[analog].prm.alm_hh && global.get(maq[i]).analog[analog].prm.alm_hh_enable){\n            global.get(maq[i]).str_alm = \"Alarme de alta - \" + analog + \" - \"  + (global.get(maq[i]).analog[analog].value).toFixed(2) + global.get(maq[i]).analog[analog].ue + \" - Limite : \" + (global.get(maq[i]).analog[analog].prm.alm_hh).toFixed(2) + global.get(maq[i]).analog[analog].ue\n            alm = true\n        }\n        \n        if(global.get(maq[i]).analog[analog].value <= global.get(maq[i]).analog[analog].prm.alm_ll && global.get(maq[i]).analog[analog].prm.alm_ll_enable){\n            global.get(maq[i]).str_alm = \"Alarme de baixa - \" + analog + \" - \"  + (global.get(maq[i]).analog[analog].value).toFixed(2) + global.get(maq[i]).analog[analog].ue + \" - Limite : \" + (global.get(maq[i]).analog[analog].prm.alm_ll).toFixed(2) + global.get(maq[i]).analog[analog].ue\n            alm = true\n        }\n        \n    }\n}\n\nif(alm){\n    return {\"payload\" : \"alm\"}\n}\n\n/*\nif(global.get(maq).motores.motor01.corrente >= global.get(maq).motores.motor01.aux.fat_alm_corr_hh){\n    global.get(maq).str_alm = \"Alarme de corrente alta motor01 - \" + (global.get(maq).motores.motor01.corrente).toFixed(2) + \"A - Limite : \" + (global.get(maq).motores.motor01.aux.fat_alm_corr_hh).toFixed(2) + \"A\"\n    return {\"payload\" : 0}\n}else if(global.get(maq).motores.motor02.corrente >= global.get(maq).motores.motor02.aux.fat_alm_corr_hh){\n    global.get(maq).str_alm = \"Alarme de corrente alta motor02 - \" + (global.get(maq).motores.motor02.corrente).toFixed(2) + \"A - Limite : \" + (global.get(maq).motores.motor02.aux.fat_alm_corr_hh).toFixed(2) + \"A\"\n    return {\"payload\" : 0}\n}else if(global.get(maq).analog.temp_set01.value >= flow.get(\"tse_amb_setor_temp_alm\")){\n    global.get(maq).str_alm = \"Alarme de temperatura alta - \" + (global.get(maq).analog.temp_set01.value).toFixed(2) + \"ᵒC - Limite : \" + (flow.get(\"tse_amb_setor_temp_alm\")).toFixed(2) + \"ᵒC\"\n    return {\"payload\" : 0}\n}else if(global.get(maq).analog.umid_set01.value >= flow.get(\"tse_amb_setor_umid_alm\")){\n    global.get(maq).str_alm = \"Alarme de umidade alta - \" + (global.get(maq).analog.umid_set01.value).toFixed(2) + \"% - Limite : \" + (flow.get(\"tse_amb_setor_umid_alm\")).toFixed(2) + \"%\"\n    return {\"payload\" : 0}\n}*/","outputs":1,"noerr":0,"x":320,"y":4260,"wires":[["f26c56d1.17adf8"]]},{"id":"f26c56d1.17adf8","type":"link out","z":"42adf1ec.1a792","name":"maq_alm","links":["4bdbe285.c2e0ec"],"x":455,"y":4260,"wires":[]},{"id":"4bdbe285.c2e0ec","type":"link in","z":"42adf1ec.1a792","name":"","links":["f26c56d1.17adf8"],"x":595,"y":480,"wires":[["a3d1870.aa6ec78"]]},{"id":"99ceea1e.fde2b8","type":"ui_text","z":"42adf1ec.1a792","group":"fbe4baa6.8db5e8","order":12,"width":10,"height":1,"name":"str_alm","label":"Falhas :","format":"{{msg.payload}}","layout":"row-left","x":480,"y":3780,"wires":[]},{"id":"f81e93f8.49b5b","type":"function","z":"42adf1ec.1a792","name":"Variáveis auxiliares","func":"const maq = flow.get(\"tse_sel_maq\")[0]\n\n//Variáveis auxiliares\nflow.set(\"tse_id_oper\", null)\nflow.set(\"tse_pcs_fat_rand\", 1)\nflow.set(\"tse_mot_env_fim\", false)\nflow.set(\"tse_amb_setor_temp_aux_fat_rand\", 1)\nflow.set(\"tse_calc_wo_time_parada\", 0)\nflow.set(\"tse_calc_wo_time_parada_aux1\", 0)\nflow.set(\"tse_calc_wo_time_parada_aux2\", 0)\nflow.set(\"tse_calc_maq_time_rodando_ini\", 0)\nflow.set(\"tse_calc_maq_time_parada_ini\", new Date())\nglobal.get(maq).wo_qtd_pcs = 0","outputs":1,"noerr":0,"x":370,"y":120,"wires":[[]]},{"id":"b823fe1c.30e6e","type":"comment","z":"42adf1ec.1a792","name":"Verifica - objeto","info":"","x":1220,"y":300,"wires":[]},{"id":"61c9ba7.88c4b44","type":"function","z":"42adf1ec.1a792","name":"OEE","func":"const maq = global.get('tse_var_maq')\n\nlet date = new Date()\nlet av = 0\nlet ppt = 0\nlet rt = 0\nlet pf = 0\nlet qlt = 0\nlet oee = 0\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).wo_ini){\n        \n        //Planned Production Time\n        ppt = (((date - global.get(maq[i]).ts_wo_ini) / 1000) / 60)\n        //Run Time\n        rt = ppt - (((global.get(maq[i]).tempo_wo_parada.getHours() * 60 * 60) + (global.get(maq[i]).tempo_wo_parada.getMinutes() * 60) + global.get(maq[i]).tempo_wo_parada.getSeconds()) / 60)\n        //Performance\n        pf = (((global.get(maq[i]).pecas_ok + global.get(maq[i]).pecas_rep) ) / rt) / global.get(maq[i]).ict\n        //Availability\n        av = (rt / ppt)\n        //Quality\n        if(global.get(maq[i]).pecas_ok > 0){\n            qlt = (global.get(maq[i]).pecas_ok  / (global.get(maq[i]).pecas_ok + global.get(maq[i]).pecas_rep))\n        }else{\n            qlt = 0\n        }\n        //Overall Equipment Effectiveness\n        oee = (av * pf * qlt) * 100\n        \n    }else{\n        ppt = 0\n        rt = 0\n        pf = 0\n        av = 0\n        qlt = 0\n        oee = 0\n    }\n    \n    global.get(maq[i]).oee_online.ppt = ppt\n    global.get(maq[i]).oee_online.rt = rt\n    global.get(maq[i]).oee_online.pf = pf * 100\n    global.get(maq[i]).oee_online.av = av * 100\n    global.get(maq[i]).oee_online.qlt = qlt * 100\n    global.get(maq[i]).oee_online.oee = oee\n}\n/*\n//Degub\nmsg.payload = \"ppt = \" + global.get(maq[i]).oee_online.ppt +\n                \"\\nrt = \" + global.get(maq[i]).oee_online.rt +\n                \"\\npf = \" + global.get(maq[i]).oee_online.pf +\n                \"\\nav = \" + global.get(maq[i]).oee_online.av +\n                \"\\nqlt = \" + global.get(maq[i]).oee_online.qlt +\n                \"\\noee = \" + global.get(maq[i]).oee_online.oee\n\nreturn msg\n*/","outputs":1,"noerr":0,"x":930,"y":1380,"wires":[[]]},{"id":"a39fcee4.adaae","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":9,"width":4,"height":1,"name":"OEE","label":"","blur":true,"minmax":false,"colorLine":"#e4ebf2","colorFromTheme":false,"stroke":2,"pointcount":"15","x":650,"y":3920,"wires":[]},{"id":"2acd3641.844d4a","type":"function","z":"42adf1ec.1a792","name":"OEE","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet gauge = []\n\n\ngauge[0] = {\"payload\" : global.get(maq[sel_maq]).oee_online.oee, \"topic\" : \"OEE\", \"unit\" : \"%\"}\ngauge[1] = {\"payload\" : global.get(maq[sel_maq]).oee_online.av, \"topic\" : \"Disponibilidade\", \"unit\" : \"%\"}\ngauge[2] = {\"payload\" : global.get(maq[sel_maq]).oee_online.pf, \"topic\" : \"Performance\", \"unit\" : \"%\"}\ngauge[3] = {\"payload\" : global.get(maq[sel_maq]).oee_online.qlt, \"topic\" : \"Qualidade\", \"unit\" : \"%\"}\n\n\nreturn [gauge[0], gauge[1], gauge[2], gauge[3]]","outputs":4,"noerr":0,"x":250,"y":3960,"wires":[["eac11ba1.0f3698","a39fcee4.adaae"],["ba020b52.06f6e8","cff403a.55485"],["8b3dec67.3fe26","22ac85fc.b7bada"],["5f8eccde.02d7d4","43e06adc.239004"]]},{"id":"b58416bb.a7b5c8","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - Dashboard - OEE","info":"","x":160,"y":3860,"wires":[]},{"id":"eac11ba1.0f3698","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":1,"width":4,"height":4,"min":0,"max":10,"name":"OEE","icon":"OEE","label":"OEE","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":450,"y":3920,"wires":[]},{"id":"ba020b52.06f6e8","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":3,"width":2,"height":2,"min":0,"max":10,"name":"Disponibilidade","icon":"","label":"Disp.","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":480,"y":3960,"wires":[]},{"id":"8b3dec67.3fe26","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":4,"width":2,"height":2,"min":0,"max":10,"name":"Performance","icon":"","label":"Perf.","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":470,"y":4000,"wires":[]},{"id":"5f8eccde.02d7d4","type":"ui_artlessgauge","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":5,"width":2,"height":2,"min":0,"max":10,"name":"Qualidade","icon":"OEE","label":"Quali.","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":460,"y":4040,"wires":[]},{"id":"cff403a.55485","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":6,"width":2,"height":1,"name":"Disponibilidade","label":"","blur":true,"minmax":false,"colorLine":"#1da1c8","colorFromTheme":false,"stroke":2,"pointcount":"15","x":680,"y":3960,"wires":[]},{"id":"22ac85fc.b7bada","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":7,"width":2,"height":1,"name":"Performance","label":"","blur":true,"minmax":false,"colorLine":"#1da1c8","colorFromTheme":false,"stroke":2,"pointcount":"15","x":670,"y":4000,"wires":[]},{"id":"43e06adc.239004","type":"ui_valuetrail","z":"42adf1ec.1a792","group":"daf4729d.4a695","order":8,"width":2,"height":1,"name":"Qualidade","label":"","blur":true,"minmax":false,"colorLine":"#1da1c8","colorFromTheme":false,"stroke":2,"pointcount":"15","x":660,"y":4040,"wires":[]},{"id":"aa871b06.031308","type":"ui_dropdown","z":"42adf1ec.1a792","name":"","label":"Login : ","tooltip":"Operador","place":" ","group":"94774b35.ea4148","order":2,"width":10,"height":1,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":1410,"y":80,"wires":[["3bd2e89e.5dd2b8"]]},{"id":"953ba71a.c09b78","type":"function","z":"42adf1ec.1a792","name":"login","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet users = global.get(maq[sel_maq]).prm.users\nlet opt = {\"payload\" : [[\"logout\"]], \"options\" : [{\"\" : \"logout\"}]}\n\nglobal.get(maq[sel_maq]).id_operador = null\nflow.set(\"tse_id_oper\", null)\n\nfor(var i=0; i < users.length ; i++){\n        \n    opt.payload[i + 1] = [users[i]]\n    let value = {}\n    value[users[i]] = users[i]\n    opt.options.push(value)\n\n}\n\nreturn opt","outputs":1,"noerr":0,"x":1270,"y":80,"wires":[["aa871b06.031308"]]},{"id":"1765bff0.ba6df","type":"ui_toast","z":"42adf1ec.1a792","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1780,"y":80,"wires":[]},{"id":"c5a8a4fc.97e7a8","type":"comment","z":"42adf1ec.1a792","name":"login","info":"","x":1190,"y":20,"wires":[]},{"id":"3bd2e89e.5dd2b8","type":"function","z":"42adf1ec.1a792","name":"operador logado","func":"//const maq = flow.get(\"tse_sel_maq\")[0]\nconst maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\nlet data = msg.payload\n\nif(data != \"logout\" && data[0][0] != \"logout\"){\n    \n    global.get(maq[sel_maq]).id_operador = data\n    flow.set(\"tse_id_oper\", data)\n    return {\"payload\" : \"Operador : \" + data + \" logado\"}\n    \n}else{\n    \n    global.get(maq[sel_maq]).id_operador = null\n    flow.set(\"tse_id_oper\", null)\n    return {\"payload\" : \"Logout do sistema - ok\"}\n}\n\n","outputs":1,"noerr":0,"x":1580,"y":80,"wires":[["1765bff0.ba6df"]]},{"id":"bbbf4132.29a95","type":"link in","z":"42adf1ec.1a792","name":"","links":["2274964a.f7ba8a","ec177a16.5c00d8"],"x":1155,"y":80,"wires":[["953ba71a.c09b78"]]},{"id":"4e898908.ecdc88","type":"ui_toast","z":"42adf1ec.1a792","position":"dialog","displayTime":"5","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":990,"y":660,"wires":[[]]},{"id":"1a8db34e.884b2d","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":1380,"wires":[]},{"id":"d45b7b9f.4f80e8","type":"link out","z":"42adf1ec.1a792","name":"maq_pc_rep","links":[],"x":1115,"y":1340,"wires":[]},{"id":"fdf3729a.0a9c8","type":"inject","z":"42adf1ec.1a792","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":440,"wires":[["a3240f16.5e688"]]},{"id":"a3240f16.5e688","type":"function","z":"42adf1ec.1a792","name":"falha forçada","func":"const maq = global.get('tse_var_maq')\nconst sel_maq = global.get(\"tse_selec_maq\")\n\n\nglobal.get(maq[sel_maq]).str_alm = \"Alarme forçado manualmente\"\nreturn {\"payload\" : \"alm\"}","outputs":1,"noerr":0,"x":470,"y":440,"wires":[["a3d1870.aa6ec78"]]},{"id":"35498bb5.eb8074","type":"comment","z":"42adf1ec.1a792","name":"Azure - Envia dados de eventos","info":"","x":1270,"y":480,"wires":[]},{"id":"49c6e5f8.fb76fc","type":"link in","z":"42adf1ec.1a792","name":"","links":["1a1ae22a.85532e","7f3e3ec0.14d8d","9119d80.1b8ab28","df8735c0.36f038","fcaf1a2.98c95e8"],"x":1235,"y":540,"wires":[[]]},{"id":"154561c5.64cb2e","type":"function","z":"42adf1ec.1a792","name":"motor02 - analógicos","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    //rampa de aceleração\n    if(global.get(maq[i]).motores.motor02.rodando === true){\n        \n        global.get(maq[i]).motores.motor02.aux.desacel_ok = false\n        if(!global.get(maq[i]).motores.motor02.aux.acel_ok){\n            \n            global.get(maq[i]).motores.motor02.corrente = parseFloat((global.get(maq[i]).motores.motor02.corrente + (global.get(maq[i]).motores.motor02.prm.corrente /  global.get(maq[i]).motores.motor02.prm.ramp_acel)).toFixed(2))\n            global.get(maq[i]).motores.motor02.potencia = parseFloat((global.get(maq[i]).motores.motor02.potencia + (global.get(maq[i]).motores.motor02.prm.potencia /  global.get(maq[i]).motores.motor02.prm.ramp_acel)).toFixed(2))\n            global.get(maq[i]).motores.motor02.torque = parseFloat((global.get(maq[i]).motores.motor02.torque + (100 /  global.get(maq[i]).motores.motor02.prm.ramp_acel)).toFixed(2))\n            global.get(maq[i]).motores.motor02.aux.acel_calc = global.get(maq[i]).motores.motor02.aux.acel_calc + 1\n            \n        }\n        \n        if(global.get(maq[i]).motores.motor02.aux.acel_calc >= global.get(maq[i]).motores.motor02.prm.ramp_acel){\n            \n            global.get(maq[i]).motores.motor02.aux.acel_ok = true\n            global.get(maq[i]).motores.motor02.aux.acel_calc = 0\n            \n        }\n        \n    }\n    \n    //rampa de desaceleração\n    if(global.get(maq[i]).motores.motor02.rodando === false){\n        \n        global.get(maq[i]).motores.motor02.aux.acel_ok = false\n        if(!global.get(maq[i]).motores.motor02.aux.desacel_ok){\n            \n            global.get(maq[i]).motores.motor02.corrente = parseFloat((global.get(maq[i]).motores.motor02.corrente - (global.get(maq[i]).motores.motor02.prm.corrente /  global.get(maq[i]).motores.motor02.prm.ramp_desacel)).toFixed(2))\n            global.get(maq[i]).motores.motor02.potencia = parseFloat((global.get(maq[i]).motores.motor02.potencia - (global.get(maq[i]).motores.motor02.prm.potencia /  global.get(maq[i]).motores.motor02.prm.ramp_desacel)).toFixed(2))\n            global.get(maq[i]).motores.motor02.torque = parseFloat((global.get(maq[i]).motores.motor02.torque - (100 /  global.get(maq[i]).motores.motor02.prm.ramp_desacel)).toFixed(2))\n            global.get(maq[i]).motores.motor02.aux.desacel_calc = global.get(maq[i]).motores.motor02.aux.desacel_calc + 1\n            \n            if(global.get(maq[i]).motores.motor02.corrente <= 0){\n                \n                global.get(maq[i]).motores.motor02.corrente = 0\n            }\n            if(global.get(maq[i]).motores.motor02.potencia <= 0){\n                \n                global.get(maq[i]).motores.motor02.potencia = 0\n            }\n            if(global.get(maq[i]).motores.motor02.torque <= 0){\n                \n                global.get(maq[i]).motores.motor02.torque = 0\n            }\n        }\n        \n        if(global.get(maq[i]).motores.motor02.aux.desacel_calc >= global.get(maq[i]).motores.motor02.prm.ramp_desacel){\n            \n            global.get(maq[i]).motores.motor02.aux.desacel_ok = true\n            global.get(maq[i]).motores.motor02.aux.desacel_calc = 0\n            global.get(maq[i]).motores.motor02.corrente = 0\n            global.get(maq[i]).motores.motor02.potencia = 0\n            global.get(maq[i]).motores.motor02.torque = 0\n            \n        }\n        \n    }\n    \n    if(global.get(maq[i]).motores.motor02.aux.acel_ok === true){\n        \n        msg.payload = \"random\"\n        return msg\n    }\n}","outputs":1,"noerr":0,"x":320,"y":2000,"wires":[["c3754e91.888e1"]]},{"id":"8d8a646f.696be8","type":"function","z":"42adf1ec.1a792","name":"motor02 - analógicos random","func":"const maq = global.get('tse_var_maq')\n\nlet random = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).motores.motor02.aux.acel_ok === true){\n        \n        global.get(maq[i]).motores.motor02.corrente = parseFloat((global.get(maq[i]).motores.motor02.prm.corrente * (random * global.get(maq[i]).motores.motor02.prm.fat_rand)).toFixed(2))\n        global.get(maq[i]).motores.motor02.potencia = parseFloat((global.get(maq[i]).motores.motor02.prm.potencia * (random * global.get(maq[i]).motores.motor02.prm.fat_rand)).toFixed(2))\n        global.get(maq[i]).motores.motor02.torque = parseFloat((100 * (random * global.get(maq[i]).motores.motor02.prm.fat_rand)).toFixed(2))\n    }\n}","outputs":1,"noerr":0,"x":780,"y":2000,"wires":[[]]},{"id":"98df7ef0.f1f83","type":"delay","z":"42adf1ec.1a792","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1280,"y":1820,"wires":[["c4129f77.0e0c6"]]},{"id":"8fc84353.74d83","type":"delay","z":"42adf1ec.1a792","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1280,"y":1880,"wires":[["75cf71e0.49d4e"]]},{"id":"c4129f77.0e0c6","type":"function","z":"42adf1ec.1a792","name":"motores - rodando","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === true && global.get(maq[i]).motores.motor01.rodando === true && global.get(maq[i]).motores.motor02.rodando === true){\n        \n        for(var mot in global.get(maq[i]).motores){\n            \n            global.get(maq[i]).motores[mot].rodando = true\n        }\n    }\n}","outputs":1,"noerr":0,"x":1470,"y":1820,"wires":[[]]},{"id":"75cf71e0.49d4e","type":"function","z":"42adf1ec.1a792","name":"motores - parado","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    if(global.get(maq[i]).rodando === false && global.get(maq[i]).motores.motor02.rodando === false && global.get(maq[i]).motores.motor01.rodando === false){\n        \n        for(var mot in global.get(maq[i]).motores){\n            \n            global.get(maq[i]).motores[mot].rodando = false\n        }\n    }\n}","outputs":1,"noerr":0,"x":1470,"y":1880,"wires":[[]]},{"id":"a58513b1.5c804","type":"function","z":"42adf1ec.1a792","name":"motores - analógicos","func":"const maq = global.get('tse_var_maq')\n\nfor(var i=0; i < maq.length ; i++){\n\n    for(var mot in global.get(maq[i]).motores){\n    \n        if(mot != \"motor01\" && mot != \"motor02\"){\n            \n            //rampa de aceleração\n            if(global.get(maq[i]).motores[mot].rodando === true){\n                \n                global.get(maq[i]).motores[mot].aux.desacel_ok = false\n                if(!global.get(maq[i]).motores[mot].aux.acel_ok){\n                    \n                    global.get(maq[i]).motores[mot].corrente = parseFloat((global.get(maq[i]).motores[mot].corrente + (global.get(maq[i]).motores[mot].prm.corrente /  global.get(maq[i]).motores[mot].prm.ramp_acel)).toFixed(2))\n                    global.get(maq[i]).motores[mot].potencia = parseFloat((global.get(maq[i]).motores[mot].potencia + (global.get(maq[i]).motores[mot].prm.potencia /  global.get(maq[i]).motores[mot].prm.ramp_acel)).toFixed(2))\n                    global.get(maq[i]).motores[mot].torque = parseFloat((global.get(maq[i]).motores[mot].torque + (100 /  global.get(maq[i]).motores[mot].prm.ramp_acel)).toFixed(2))\n                    global.get(maq[i]).motores[mot].aux.acel_calc = global.get(maq[i]).motores[mot].aux.acel_calc + 1\n                    \n                }\n                \n                if(global.get(maq[i]).motores[mot].aux.acel_calc >= global.get(maq[i]).motores[mot].prm.ramp_acel){\n                    \n                    global.get(maq[i]).motores[mot].aux.acel_ok = true\n                    global.get(maq[i]).motores[mot].aux.acel_calc = 0\n                    \n                }\n                \n            }\n            \n            //rampa de desaceleração\n            if(global.get(maq[i]).motores[mot].rodando === false){\n                \n                global.get(maq[i]).motores[mot].aux.acel_ok = false\n                if(!global.get(maq[i]).motores[mot].aux.desacel_ok){\n                    \n                    global.get(maq[i]).motores[mot].corrente = parseFloat((global.get(maq[i]).motores[mot].corrente - (global.get(maq[i]).motores[mot].prm.corrente /  global.get(maq[i]).motores[mot].prm.ramp_desacel)).toFixed(2))\n                    global.get(maq[i]).motores[mot].potencia = parseFloat((global.get(maq[i]).motores[mot].potencia - (global.get(maq[i]).motores[mot].prm.potencia /  global.get(maq[i]).motores[mot].prm.ramp_desacel)).toFixed(2))\n                    global.get(maq[i]).motores[mot].torque = parseFloat((global.get(maq[i]).motores[mot].torque - (100 /  global.get(maq[i]).motores[mot].prm.ramp_desacel)).toFixed(2))\n                    global.get(maq[i]).motores[mot].aux.desacel_calc = global.get(maq[i]).motores[mot].aux.desacel_calc + 1\n                    \n                    if(global.get(maq[i]).motores[mot].corrente <= 0){\n                        \n                        global.get(maq[i]).motores[mot].corrente = 0\n                    }\n                    if(global.get(maq[i]).motores[mot].potencia <= 0){\n                        \n                        global.get(maq[i]).motores[mot].potencia = 0\n                    }\n                    if(global.get(maq[i]).motores[mot].torque <= 0){\n                        \n                        global.get(maq[i]).motores[mot].torque = 0\n                    }\n                }\n                \n                if(global.get(maq[i]).motores[mot].aux.desacel_calc >= global.get(maq[i]).motores[mot].prm.ramp_desacel){\n                    \n                    global.get(maq[i]).motores[mot].aux.desacel_ok = true\n                    global.get(maq[i]).motores[mot].aux.desacel_calc = 0\n                    global.get(maq[i]).motores[mot].corrente = 0\n                    global.get(maq[i]).motores[mot].potencia = 0\n                    global.get(maq[i]).motores[mot].torque = 0\n                    \n                }\n                \n            }\n            \n            if(global.get(maq[i]).motores[mot].aux.acel_ok === true){\n                \n                msg.payload = \"random\"\n                return msg\n            }\n            \n        }\n    }\n}","outputs":1,"noerr":0,"x":320,"y":2060,"wires":[["b757f63b.98a0e8"]]},{"id":"b757f63b.98a0e8","type":"random","z":"42adf1ec.1a792","name":"","low":"0.7","high":"0.9","inte":"false","property":"payload","x":540,"y":2060,"wires":[["9897d6bb.5f2718"]]},{"id":"9897d6bb.5f2718","type":"function","z":"42adf1ec.1a792","name":"motores - analógicos random","func":"const maq = global.get('tse_var_maq')\n\nlet random = msg.payload\n\nfor(var i=0; i < maq.length ; i++){\n    \n    for(var mot in global.get(maq[i]).motores){\n    \n        if(mot != \"motor01\" && mot != \"motor02\"){\n            \n            if(global.get(maq[i]).motores[mot].aux.acel_ok === true){\n                \n                global.get(maq[i]).motores[mot].corrente = parseFloat((global.get(maq[i]).motores[mot].prm.corrente * (random * global.get(maq[i]).motores[mot].prm.fat_rand)).toFixed(2))\n                global.get(maq[i]).motores[mot].potencia = parseFloat((global.get(maq[i]).motores[mot].prm.potencia * (random * global.get(maq[i]).motores[mot].prm.fat_rand)).toFixed(2))\n                global.get(maq[i]).motores[mot].torque = parseFloat((100 * (random * global.get(maq[i]).motores[mot].prm.fat_rand)).toFixed(2))\n            }\n        }\n    }\n}","outputs":1,"noerr":0,"x":780,"y":2060,"wires":[[]]},{"id":"7edf3a22.828804","type":"ui_button","z":"42adf1ec.1a792","name":"","group":"94774b35.ea4148","order":9,"width":4,"height":1,"passthru":false,"label":"Reset","tooltip":"","color":"","bgcolor":"","icon":"","payload":"reset_oper","payloadType":"str","topic":"","x":490,"y":480,"wires":[["a3d1870.aa6ec78"]]},{"id":"19cd3fdb.943f9","type":"debug","z":"42adf1ec.1a792","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":860,"y":2400,"wires":[]},{"id":"f38bbd0b.d9bca","type":"ui_date_picker","z":"39d3df0.a28d222","name":"","label":"Inicial: ","group":"6926e97d.7c2dd8","order":10,"width":4,"height":1,"passthru":true,"topic":"","x":270,"y":280,"wires":[["7a0d8771.39ddc8","80663a32.7f2618"]]},{"id":"83cd34c9.2913e8","type":"ui_date_picker","z":"39d3df0.a28d222","name":"","label":"Final: ","group":"6926e97d.7c2dd8","order":12,"width":4,"height":1,"passthru":true,"topic":"","x":270,"y":320,"wires":[["82ff3243.612ce"]]},{"id":"842398dc.001d18","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":280,"wires":[]},{"id":"b2e00a8c.7d0cf8","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":320,"wires":[]},{"id":"d8df250b.4f9618","type":"function","z":"39d3df0.a28d222","name":"","func":"//msg.payload = global.get('tse_var_maq')\n\nlet maq = []\nlet opt = {\"payload\" : [[\"todas\"]], \"options\" : [{\"todas\" : \"todas\"}]}\n\nfor(let i=0; i < global.get('tse_var_maq').length ; i++){\n\n    //maq[i] = global.get('NomeMaq')(i)\n    opt.payload[i] = [global.get('NomeMaq')(i)]\n    let value = {}\n    value[global.get('NomeMaq')(i)] = global.get('NomeMaq')(i)\n    opt.options.push(value)\n    \n}\n\nreturn opt\n","outputs":1,"noerr":0,"x":930,"y":880,"wires":[["421cacb9.d09504"]]},{"id":"17d1f126.7bec0f","type":"inject","z":"39d3df0.a28d222","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":770,"y":880,"wires":[["d8df250b.4f9618"]]},{"id":"421cacb9.d09504","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":880,"wires":[]},{"id":"10a5a4c8.9ba05b","type":"function","z":"90565ab.23a4fa8","name":"Classes","func":"//--Classes\n\ncontext.global.tse_simu_prm_motor_online = function() {\n    this.corrente = 20.6    //Corrente do motor\n    this.potencia = 7.5     //Potência do motor\n    this.ramp_acel = 10     //Rampa de aceleração (s)\n    this.ramp_desacel = 10  //Rampa de desaceleração (s)\n    this.alm_corr_hh = 50   //Alarme de corrente (% acima da corrente configurada em this.corrente)\n    this.fat_rand = 1       //fator da randomização\n}\n\ncontext.global.tse_simu_aux_motor_online = function() {\n    this.fat_alm_corr_hh = 0//fator do alarme de corrente\n    this.acel_ok = false    //flag aceleração ok\n    this.desacel_ok = false //flag desaceleração ok\n    this.acel_calc = 0      //calculo aceleraçao\n    this.desacel_calc = 0   //calculo desaceleração\n}\n\ncontext.global.tse_simu_motor_online = function() {\n    this.id = \"\"\n    this.rodando = false\n    this.falha = false\n    this.corrente = 0\n    this.potencia = 0\n    this.torque = 0\n    this.prm = new context.global.tse_simu_prm_motor_online()\n    this.aux = new context.global.tse_simu_aux_motor_online()\n}\n\ncontext.global.tse_simu_prm_analog_online = function() {\n    this.escala_max = 100       //Escala máxima do instrumento\n    this.alm_hh = 50            //Alarme de hh (this.value >= this.prm.alm_hh)\n    this.alm_ll = 5             //Alarme de ll (this.value <= this.prm.alm_ll)\n    this.alm_hh_enable = false  //Habilita / desabilita alarme hh\n    this.alm_ll_enable = false  //Habilita / desabilita alarme ll\n    this.fat_rand = 1   //fator da randomização\n}\n\ncontext.global.tse_simu_analog_online = function() {\n    this.id = \"\"\n    this.value = 0\n    this.ue = \"\"\n    this.falha = false\n    this.prm = new context.global.tse_simu_prm_analog_online()\n}\n\ncontext.global.tse_simu_oee_online = function() {\n    this.oee = 0    //Overall Equipment Effectiveness\n    this.av = 0     //Availability\n    this.pf = 0     //Performance\n    this.qlt = 0    //Quality\n    this.ppt = 0    //Planned Production Time\n    this.rt = 0     //Run Time\n}\n\ncontext.global.tse_simu_prm_online = function() {\n    this.users = [\"admin\"]\n    this.batch = [\"Produto01\"]\n    this.qtd_pcs = [1000]\n    this.amb_setor_temp_delta = 10 //Diferença entre temperatura externa via API para setor\n    this.amb_setor_temp_trab = 23 //Temperatura de trabalho ideal\n    this.amb_setor_temp_alm = 20 //Alarme de temperatura (% acima da temperatura configurada)\n    this.amb_setor_umid_delta = 10 //Diferença entre umidade externa via API para setor\n    this.amb_setor_umid_trab = 35 //Umidade de trabalho ideal\n    this.amb_setor_umid_alm = 20 //Alarme de umidade (% acima da umidade configurada)\n}\n\ncontext.global.tse_simu_aux_online = function() {\n    this.id_oper = null\n    this.pcs_fat_rand = 1\n    this.mot_env_fim = false\n    this.amb_setor_temp_aux_fat_rand = 1\n    this.calc_wo_time_parada = 0\n    this.calc_wo_time_parada_aux1 = 0\n    this.calc_wo_time_parada_aux2= 0\n    this.calc_maq_time_rodando_ini = 0\n    this.calc_maq_time_parada_ini = new Date()\n    this.rand_val_liga = 0\n    this.rand_val_falha = 0\n    this.rand_val_rodando = 0\n    this.rand_val_wo = 0\n    this.rand_val_pcs = 0\n}\n\ncontext.global.tse_simu_maq_online = function() {\n    this.id_operador = null\n    this.ligado = false\n    this.falha = false\n    this.rodando = false\n    this.manutencao = false\n    this.ict = 120 //ICT = peças por minuto\n    this.pecas_ok = 0\n    this.pecas_rep = 0\n    this.wo = \"\"\n    this.batch = \"\"\n    this.wo_ini = false\n    this.wo_fim = false\n    this.wo_qtd_pcs = 0\n    this.ts_wo_ini = null\n    this.ts_wo_fim = null\n    this.tempo_wo_total = new Date(0)\n    this.tempo_wo_parada = new Date(0)\n    this.tempo_maq_rodando = new Date(0)\n    this.tempo_maq_parada = new Date(0)\n    this.motores = {}\n    this.analog = {}\n    this.oee_online = new context.global.tse_simu_oee_online()\n    this.prm = new context.global.tse_simu_prm_online()\n    this.aux = new context.global.tse_simu_aux_online()\n    this.str_alm = \"sem falhas\"\n}\n\ncontext.global.tse_simu_ckbox_op_linha = function() {\n    this.id = \"\"\n    this.id_str = \"\"\n    this.check = false\n    this.Maquinas = {}\n}\n\ncontext.global.tse_simu_ckbox_op_maquina = function() {\n    this.id = \"\"\n    this.id_str = \"\"\n    this.check = false\n}\n\ncontext.global.tse_simu_ckbox_linhas = function() {\n    this.linhas = {}\n}\n\nreturn {\"payload\" : \"ok\"}","outputs":1,"noerr":0,"x":260,"y":140,"wires":[["a9d6f106.8031f"]]},{"id":"a9d6f106.8031f","type":"function","z":"90565ab.23a4fa8","name":"Funções","func":"//--Funções\n\nlet maq = global.get('tse_simu_maq')\n\ncontext.global.VerTurno = function(date, tz) {\n    \n    /**\n     * VerTurno()\n     * Utilização global.get('VerTurno')(date, tz)\n     * Variáveis : date = DateTime - (Data)\n     *              tz = Number int - (time zone - utilizar \"-\" se timezone for negativo)\n     * Retorno : 1 | 2 | 3 - 06:00 <> 13:59 = 1 | 14:00 <> 21:59 = 2 | 22:00 <> 05:59 = 3\n    */\n\n    this.date_aux\n    \n    if(date !== null){\n        \n        this.date_aux = new Date(date)\n        this.date_aux = new Date(this.date_aux.setHours(this.date_aux.getHours() + tz))\n    \n        if(this.date_aux.getHours() >= 6 && this.date_aux.getHours() < 14){\n            return 1\n        }else if(this.date_aux.getHours() >= 14 && this.date_aux.getHours() < 22){\n            return 2\n        }else{\n            return 3\n        }\n    }else{\n        return \"Erro\"\n    }\n    \n}\n\ncontext.global.StrDateTz = function(date, tz) {\n    \n    /**\n     * StrDateTz()\n     * Utilização global.get('StrDateTz')(date, tz)\n     * Variáveis : date = DateTime - (Data)\n     *              tz = Number int - (time zone - utilizar \"-\" se timezone for negativo)\n     * Retorno : dd/mm/aaaa - hh:mm:ss\n    */\n    \n    this.date_aux\n     \n    if(date !== null){\n        \n        this.date_aux = new Date(date)\n        this.date_aux = new Date(this.date_aux.setHours(this.date_aux.getHours() + tz))\n    \n        this.date_aux = (\"00\" + this.date_aux.getDate()).slice(-2) +\n                        \"/\" + (\"00\" + (this.date_aux.getMonth() + 1)).slice(-2) +\n                        \"/\" + this.date_aux.getFullYear() +\n                        \" - \" + (\"00\" + this.date_aux.getHours()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getMinutes()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getSeconds()).slice(-2)\n        return this.date_aux\n    }else{\n        return \"\"\n    }\n    \n}\n\ncontext.global.StrDateToTime = function(date) {\n    \n    /**\n     * StrDateTz()\n     * Utilização global.get('StrDateToTime')(date)\n     * Variáveis : date = DateTime - (Data)\n     * Retorno : hh:mm:ss\n    */\n    \n    this.date_aux\n    \n    if(date !== null){\n        \n        this.date_aux = new Date(date)\n        this.date_aux = (\"00\" + this.date_aux.getHours()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getMinutes()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getSeconds()).slice(-2)\n        return this.date_aux\n    }else{\n        return \"\"\n    }\n}\n\ncontext.global.GeraWO = function(date, tz, id) {\n    \n    /**\n     * GeraWO()\n     * Utilização global.get('GeraWO')(date, tz, maq)\n     * Variáveis : date = DateTime - (Data)\n     *              tz = Number int - (time zone - utilizar \"-\" se timezone for negativo)\n     *              id = Number int - (id maquina)\n     * Retorno : aaaammddhhmmss[maqid]_T[turno] '20200319203000l1m1_T02' \n    */\n    \n    this.date_aux\n    \n    if(date !== null){\n        \n        this.date_aux = new Date(date)\n        this.date_aux = new Date(this.date_aux.setHours(this.date_aux.getHours() + tz))\n        \n        this.date_aux = this.date_aux.getFullYear() +\n                        (\"00\" + (this.date_aux.getMonth() + 1)).slice(-2) +\n                        (\"00\" + this.date_aux.getDate()).slice(-2) +\n                        (\"00\" + this.date_aux.getHours()).slice(-2) +\n                        (\"00\" + this.date_aux.getMinutes()).slice(-2) +\n                        (maq[id].split(\"_\"))[0] + (maq[id].split(\"_\"))[1] + \"_T\" +\n                        global.get('VerTurno')(this.date_aux, 0)\n        return this.date_aux\n    }else{\n        return \"Erro\"\n    }\n}\n\ncontext.global.StrDateTzSql = function(date, tz) {\n    \n    /**\n     * StrDateTz()\n     * Utilização global.get('StrDateTz')(date, tz)\n     * Variáveis : date = DateTime - (Data)\n     *              tz = Number int - (time zone - utilizar \"-\" se timezone for negativo)\n     * Retorno : aaaa-mm-dd hh:mm:ss.mmm +|- mm:mm - '2020-03-19 20:30:00.1234 -03:00' \n    */\n    \n    this.date_aux\n     \n    if(date !== null){\n        \n        this.date_aux = new Date(date)\n        this.date_aux = new Date(this.date_aux.setHours(this.date_aux.getHours() + tz))\n    \n        this.date_aux = \"'\" + this.date_aux.getFullYear() +\n                        \"-\" + (\"00\" + (this.date_aux.getMonth() + 1)).slice(-2) +\n                        \"-\" + (\"00\" + this.date_aux.getDate()).slice(-2) +\n                        \" \" + (\"00\" + this.date_aux.getHours()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getMinutes()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getSeconds()).slice(-2) +\n                        \".\" + (\"000\" + this.date_aux.getMilliseconds()).slice(-3) +\n                        \" \" + tz + \":00'\"\n        return this.date_aux\n    }else{\n        return null\n    }\n    \n}\n\ncontext.global.StrDateToTimeSql = function(date) {\n    \n    /**\n     * StrDateTz()\n     * Utilização global.get('StrDateToTime')(date)\n     * Variáveis : date = DateTime - (Data)\n     * Retorno : hh:mm:ss.000\n    */\n    \n    this.date_aux\n    \n    if(date !== null){\n        \n        this.date_aux = new Date(date)\n        this.date_aux = \"'\" + (\"00\" + this.date_aux.getHours()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getMinutes()).slice(-2) +\n                        \":\" + (\"00\" + this.date_aux.getSeconds()).slice(-2) +\n                        \".000'\"\n        return this.date_aux\n    }else{\n        return null\n    }\n}\n\ncontext.global.NomeMaq = function(id) {\n    \n    /**\n     * NomeMaq()\n     * Utilização global.get('NomeMaq')(id)\n     * Variáveis : id = Number int - (id maquina)\n     * Retorno : lx_mx - Ex.: Linha01 - Maquina01 'l1_m1'\n    */\n    \n    if(id !== null){\n        \n        return maq[id]\n    }else{\n        return \"Erro\"\n    }\n}\n\ncontext.global.ResetVarMaq = function(id) {\n    \n    /**\n     * ResetVarMaq()\n     * Utilização global.get('ResetVarMaq')(id)\n     * Variáveis : id = Number int - (id maquina)\n    */\n    \n    this.maq_id = global.get('tse_var_maq')[id]\n    \n    if(id !== null){\n        \n        global.get(this.maq_id).pecas_ok = 0\n        global.get(this.maq_id).pecas_rep = 0\n        global.get(this.maq_id).wo = \"\"\n        global.get(this.maq_id).batch = \"\"\n        global.get(this.maq_id).wo_ini = false\n        global.get(this.maq_id).wo_fim = false\n        global.get(this.maq_id).wo_qtd_pcs = 0\n        global.get(this.maq_id).ts_wo_ini = null\n        global.get(this.maq_id).ts_wo_fim = null\n        global.get(this.maq_id).tempo_wo_total = new Date(0)\n        global.get(this.maq_id).tempo_wo_parada = new Date(0)\n        global.get(this.maq_id).str_alm = \"sem falhas\"\n        \n        for(var mot in global.get(this.maq_id).motores){\n    \n            global.get(this.maq_id).motores[mot].rodando = false\n            global.get(this.maq_id).motores[mot].falha = false\n            global.get(this.maq_id).motores[mot].corrente = 0\n            global.get(this.maq_id).motores[mot].potencia = 0\n            global.get(this.maq_id).motores[mot].torque = 0\n        }\n        \n    }else{\n        return \"Erro\"\n    }\n    \n}\n\ncontext.global.TodasLinhas = function(rep) {\n    \n    /**\n     * TodasLinhas(rep)\n     * Descrição : Retorna todas as linhas que foram configuradas na variável maq dos parâmetros de inicialização\n     * Utilização global.get('TodasLinhas')(rep)\n     * Variáveis : rep = bolean - (true/false)\n     * Retorno : rep = true [l1, l1, l2, l2, l3, ...] / rep = false [l1, l2, l3, ....]\n    */\n    \n    this.linhas = []\n    this.strlinhas = []\n    \n    if(rep !== true && rep !== false){\n        \n        return {\"linhas\" : [\"Erro\"], \"strlinhas\" : [\"Erro\"]}\n        \n    }else if(rep){\n        \n        for(this.i=0; this.i < maq.length ; this.i++){\n        \n\t\t    this.linhas[this.i] = (maq[i].split(\"_\"))[0]\n\t\t    this.strlinhas[this.i] = \"Linha: \" + this.linhas[this.i].split(\"l\")[1]\n        }\n        return {\"linhas\" : this.linhas, \"strlinhas\" : this.strlinhas}\n    }else{\n        \n        for(this.i=0; this.i < maq.length ; this.i++){\n        \n\t\t    if(!this.linhas.includes((maq[i].split(\"_\"))[0])){\n\t\t        \n\t\t        this.linhas.push((maq[i].split(\"_\"))[0])\n\t\t        this.strlinhas.push(\"Linha: \" + (maq[i].split(\"_\"))[0].split(\"l\")[1])\n\t\t        \n\t\t    }\n\t\t    \n        }\n        return {\"linhas\" : this.linhas, \"strlinhas\" : this.strlinhas}\n    }\n}\n\ncontext.global.MaquinasLinha = function(linha) {\n    \n    /**\n     * MaquinasLinha(linha)\n     * Descrição : Retorna todas as maquinas que foram configuradas na variável maq dos parâmetros de inicialização\n     * Utilização global.get('MaquinasLinha')(linha)\n     * Retorno : [maquinas : {1, 2, 3, 1, 2, 1, ...}, strmaquinas : {\"L:1 - Maquina: 1\", \"L:1 - Maquina: 2\", .... }]\n    */\n    \n    this.maquinas = []\n    this.strmaquinas = []\n    this.linhas = global.get('TodasLinhas')(false)\n    \n    if(this.linhas.linhas.includes(linha) || linha == \"*\"){\n        \n       for(this.i=0; this.i < maq.length ; this.i++){\n            \n            if(linha != \"*\"){\n                \n                if((maq[i].split(\"_\"))[0] == linha){\n    \t        \n        \t        this.maquinas.push(maq[i])\n        \t        this.strmaquinas.push(\"L:\" + (maq[i].split(\"_\"))[0].split(\"l\")[1] + \" - Maquina: \" + (maq[i].split(\"_\"))[1].split(\"m\")[1])\n    \t        }\n                \n            }else{\n                \n                this.maquinas.push(maq[i])\n        \t    this.strmaquinas.push(\"L:\" + (maq[i].split(\"_\"))[0].split(\"l\")[1] + \" - Maquina: \" + (maq[i].split(\"_\"))[1].split(\"m\")[1])\n                \n            }\n    \t    \n        }\n        return {\"maquinas\" : this.maquinas, \"strmaquinas\" : this.strmaquinas} \n    }else{\n        return {\"maquinas\" : [\"Erro\"], \"strmaquinas\" : [\"Erro\"]} \n    }\n}\n\n\n\nif(msg.payload === \"ok\"){\n    return {\"payload\" : \"ok\"}\n}","outputs":1,"noerr":0,"x":260,"y":180,"wires":[["93ddea2a.5d5788"]]},{"id":"6fd508a4.c4c488","type":"function","z":"90565ab.23a4fa8","name":"Parâmetros de inicialização","func":"//Nome das Maquinas - Gera objeto\nconst maq = [\"l1_m1\", \"l1_m2\", \"l1_m3\", \"l2_m1\", \"l2_m2\", \"l3_m1\"]\n\n\n\n//Torna global as maquinas\nglobal.set('tse_simu_maq', maq)\n\nreturn {\"payload\" : \"ok\"}","outputs":1,"noerr":0,"x":320,"y":100,"wires":[["10a5a4c8.9ba05b"]]},{"id":"295aacfd.ae8b24","type":"inject","z":"90565ab.23a4fa8","name":"Atualizar","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":180,"wires":[["a9d6f106.8031f"]]},{"id":"98a461a1.9af35","type":"function","z":"39d3df0.a28d222","name":"","func":"//msg.payload = global.get('tse_var_maq')\n\nlet maq = []\nlet opt = {\"payload\" : [[\"todas\"]], \"options\" : [{\"todas\" : \"todas\"}]}\n\nfor(let i=0; i < global.get('tse_simu_n_linha').length ; i++){\n    \n    if(!opt.payload.includes(global.get('tse_simu_n_linha')[i])){\n        \n        opt.payload[i] = [global.get('tse_simu_n_linha')[i]]\n        let value = {}\n        value[\"Linha \" + global.get('tse_simu_n_linha')[i]] = global.get('tse_simu_n_linha')[i]\n        opt.options.push(value)\n        \n    }\n    \n    \n}\n\nreturn opt\n// global.set('tse_simu_n_linha', [])\n// global.set('tse_simu_n_maq', [])\n\n\n// let teste = [1, 2, 3]\n\n// msg.payload = teste.includes(4)\n// // msg.payload = global.get('tse_simu_n_linha')\n// return msg","outputs":1,"noerr":0,"x":930,"y":820,"wires":[["ea419083.afcb6"]]},{"id":"c9397fb8.d5ce","type":"inject","z":"39d3df0.a28d222","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":770,"y":820,"wires":[["98a461a1.9af35"]]},{"id":"ea419083.afcb6","type":"debug","z":"39d3df0.a28d222","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":820,"wires":[]},{"id":"8e45256a.0ecc58","type":"ui_list","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","name":"Linhas","order":2,"width":3,"height":4,"lineType":"one","actionType":"check","allowHTML":true,"outputs":1,"topic":"Seleção","x":470,"y":140,"wires":[["92bf222c.46111"]]},{"id":"77e6a2b1.56998c","type":"function","z":"39d3df0.a28d222","name":"busca linhas","func":"flow.set(\"tse_OEE_date_ini\", new Date())\nflow.set(\"tse_OEE_date_fim\", new Date())\nflow.set(\"tse_OEE_hora_ini\", [])\nflow.set(\"tse_OEE_hora_fim\", [])\n\nlet linhas = global.get('TodasLinhas')(false)\nlet checkbox = []\nlet checkbox_maq = {\"payload\" : []}\n\nfor(let i=0; i < linhas.strlinhas.length ; i++){\n\n    checkbox.push({\"title\" : linhas.strlinhas[i]})\n}\nmsg.payload = checkbox\nreturn [msg, checkbox_maq];","outputs":2,"noerr":0,"x":290,"y":140,"wires":[["8e45256a.0ecc58"],["88010d72.6889c"]]},{"id":"3f3e6f6b.32c58","type":"debug","z":"39d3df0.a28d222","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":140,"wires":[]},{"id":"293aadb2.dec782","type":"ui_template","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","name":"","order":1,"width":10,"height":1,"format":"<H3>\n    <b>  Selecione linhas / maquinas:</b>   \n</H3>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":100,"y":100,"wires":[[]]},{"id":"a8737b49.724a68","type":"function","z":"39d3df0.a28d222","name":"busca linhas","func":"let linhas = global.get('TodasLinhas')(false)\nlet checkbox = []\n\nfor(let i=0; i < linhas.strlinhas.length ; i++){\n\n    checkbox.push({\"title\" : linhas.strlinhas[i]})\n}\nmsg.payload = global.get('tse_simu_chkbox_linhas')\n//msg.payload = global.get('TodasLinhas')(false).linhas\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":760,"wires":[["5ebecf1.eab4e3"]]},{"id":"25ed7def.eb3fa2","type":"inject","z":"39d3df0.a28d222","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":770,"y":760,"wires":[["a8737b49.724a68"]]},{"id":"5ebecf1.eab4e3","type":"debug","z":"39d3df0.a28d222","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1190,"y":760,"wires":[]},{"id":"92bf222c.46111","type":"function","z":"39d3df0.a28d222","name":"busca maquinas","func":"let linha = msg.payload\nlet linhas = global.get('TodasLinhas')(false)\n//let maquinas\nlet checkbox = []\n\nlinha.title = \"l\" + linha.title.split(\"Linha: \")[1]\n\nglobal.get('tse_simu_chkbox_linhas').linhas[linha.title].check = linha.isChecked\n\n\nfor(let i=0; i < linhas.linhas.length; i++){\n    \n    if(global.get('tse_simu_chkbox_linhas').linhas[linhas.linhas[i]].check){\n        \n        let maquinas = global.get('MaquinasLinha')(linhas.linhas[i])\n        \n        for(let j=0; j < maquinas.maquinas.length; j++){\n        \n            checkbox.push({\"title\" : maquinas.strmaquinas[j]})\n            //maquinas = global.get('MaquinasLinha')(linhas[i])\n        }\n        //checkbox[i] = maquinas.maquinas.length\n    }\n}\n\n\nmsg.payload = checkbox\nreturn msg","outputs":1,"noerr":0,"x":660,"y":140,"wires":[["88010d72.6889c"]]},{"id":"7cb16792.c402e8","type":"function","z":"39d3df0.a28d222","name":"busca maquinas","func":"\n//msg.payload = global.get('tse_simu_chkbox_linhas')\n\nmsg.payload = global.get('MaquinasLinha')(\"l2\")\n//msg.payload = global.get('TodasLinhas')(false)\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":700,"wires":[["4aa444d0.64eb5c"]]},{"id":"4aa444d0.64eb5c","type":"debug","z":"39d3df0.a28d222","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1150,"y":700,"wires":[]},{"id":"c2986cad.205eb","type":"inject","z":"39d3df0.a28d222","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":790,"y":700,"wires":[["7cb16792.c402e8"]]},{"id":"88010d72.6889c","type":"ui_list","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","name":"Maquinas","order":6,"width":4,"height":4,"lineType":"one","actionType":"check","allowHTML":true,"outputs":1,"topic":"Seleção","x":860,"y":140,"wires":[["3f3e6f6b.32c58"]]},{"id":"40d97308.34511c","type":"inject","z":"39d3df0.a28d222","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":280,"wires":[["f38bbd0b.d9bca"]]},{"id":"90e755ba.171058","type":"ui_button","z":"39d3df0.a28d222","name":"","group":"6926e97d.7c2dd8","order":16,"width":10,"height":1,"passthru":false,"label":"Buscar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":270,"y":460,"wires":[["36a733ba.cbbfdc"]]},{"id":"7a0d8771.39ddc8","type":"function","z":"39d3df0.a28d222","name":"","func":"flow.set(\"tse_OEE_date_ini\", new Date(msg.payload))\nmsg.payload = flow.get(\"tse_OEE_date_ini\")\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":280,"wires":[["842398dc.001d18"]]},{"id":"82ff3243.612ce","type":"function","z":"39d3df0.a28d222","name":"","func":"flow.set(\"tse_OEE_date_fim\", new Date(msg.payload))\nmsg.payload = flow.get(\"tse_OEE_date_fim\")\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":320,"wires":[["b2e00a8c.7d0cf8"]]},{"id":"95b51e2f.e3c86","type":"ui_text_input","z":"39d3df0.a28d222","name":"","label":"Hora ini:","tooltip":"","group":"6926e97d.7c2dd8","order":13,"width":4,"height":1,"passthru":true,"mode":"time","delay":300,"topic":"","x":260,"y":360,"wires":[["69aec27d.ecca1c"]]},{"id":"58f0ebfb.8b8454","type":"ui_text_input","z":"39d3df0.a28d222","name":"","label":"Hora fim:","tooltip":"","group":"6926e97d.7c2dd8","order":15,"width":4,"height":1,"passthru":true,"mode":"time","delay":300,"topic":"","x":260,"y":400,"wires":[["45ed8825.8b9b28"]]},{"id":"cf221e70.b91ff","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":360,"wires":[]},{"id":"adb85cd2.9f036","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":400,"wires":[]},{"id":"69aec27d.ecca1c","type":"function","z":"39d3df0.a28d222","name":"","func":"let data = msg.payload\nlet hora_ini = []\n\nhora_ini[0] = parseInt(((data / 1000 ) / 60 / 60))\nhora_ini[1] = ((((data / 1000 ) / 60)) % 60)\n\nflow.set(\"tse_OEE_hora_ini\", hora_ini)\nmsg.payload = flow.get(\"tse_OEE_hora_ini\")\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":360,"wires":[["cf221e70.b91ff"]]},{"id":"45ed8825.8b9b28","type":"function","z":"39d3df0.a28d222","name":"","func":"let data = msg.payload\nlet hora_fim = []\n\nhora_fim[0] = parseInt(((data / 1000 ) / 60 / 60))\nhora_fim[1] = ((((data / 1000 ) / 60)) % 60)\n\nflow.set(\"tse_OEE_hora_fim\", hora_fim)\nmsg.payload = flow.get(\"tse_OEE_hora_fim\")\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":400,"wires":[["adb85cd2.9f036"]]},{"id":"227fda57.c943e6","type":"ui_template","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","name":"config","order":4,"width":1,"height":1,"format":"<script>\n(function() {\n    (function(scope) {\n        scope.send({payload: \"config\"});\n    })(scope);\n})();\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":110,"y":140,"wires":[["77e6a2b1.56998c"]]},{"id":"36a733ba.cbbfdc","type":"function","z":"39d3df0.a28d222","name":"Select","func":"let query\nlet date_ini = new Date(flow.get(\"tse_OEE_date_ini\"))\nlet date_fim = new Date(flow.get(\"tse_OEE_date_fim\"))\n\ndate_ini.setHours(parseInt(flow.get(\"tse_OEE_hora_ini\")[0]) + 3)\ndate_ini.setMinutes(parseInt(flow.get(\"tse_OEE_hora_ini\")[1]))\ndate_ini.setSeconds(0)\ndate_ini.setMilliseconds(0)\ndate_fim.setHours(parseInt(flow.get(\"tse_OEE_hora_fim\")[0]) + 3)\ndate_fim.setMinutes(parseInt(flow.get(\"tse_OEE_hora_fim\")[1]))\ndate_fim.setSeconds(0)\ndate_fim.setMilliseconds(0)\n\ndate_ini = global.get('StrDateTzSql')(date_ini, -3)\ndate_fim = global.get('StrDateTzSql')(date_fim, -3)\n\n\n//Retorno : aaaa-mm-dd hh:mm:ss.mmm +|- mm:mm - '2020-03-19 20:30:00.1234 -03:00' \n\nquery = \"SELECT DISTINCT wo, \" +\n                        \"id_maq, \" + \n                        \"ict, \" +\n                        \"pecas_ok, \" +\n                        \"pecas_rep, \" + \n                        \"batch, \" + \n                        \"wo_qtd_pcs, \" +\n                        \"ts_wo_ini, \" +\n                        \"ts_wo_fim, \" +\n                        \"tempo_wo_total, \" +\n                        \"tempo_wo_parada \" + \n                        \"FROM Maquinas WHERE \" +\n                        \"ts_wo_ini >= \" + date_ini + \" \" +\n                        \"AND ts_wo_fim <= \" + date_fim + \" \" +\n                        \"AND ts_wo_ini IS NOT NULL AND ts_wo_fim IS NOT NULL;\"\n\nreturn {\"payload\" : query, \"topic\" : \"select_oee_hist\"}","outputs":1,"noerr":0,"x":430,"y":460,"wires":[["6379dff1.b918b","510eac2a.43d2d4"]]},{"id":"2d20d658.02566a","type":"MSSQL","z":"39d3df0.a28d222","mssqlCN":"58b4d8e9.9e5028","name":"Sql Azure","query":"{{msg.payload}}","outField":"payload","x":780,"y":600,"wires":[["3b95dccb.d25cf4"]]},{"id":"3b95dccb.d25cf4","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":970,"y":600,"wires":[]},{"id":"90a72076.a9b2f","type":"function","z":"39d3df0.a28d222","name":"OEE","func":"//const maq = flow.get(\"tse_sel_maq\")[0]\n\nlet query = msg.payload\n\nlet av = [0]\nlet ppt = [0]\nlet rt = [0]\nlet pf = [0]\nlet qlt = [0]\nlet oee = [0]\n\n// if(query[i].wo_ini){\n\nfor(let i=0; i < query.length; i++){\n    \n    //Planned Production Time\n    ppt[i + 1] = ((( query[i].ts_wo_fim - query[i].ts_wo_ini) / 1000) / 60)\n    //Run Time\n    rt[i + 1] = ppt[i + 1] - (((query[i].tempo_wo_parada.getHours() * 60 * 60) + (query[i].tempo_wo_parada.getMinutes() * 60) + query[i].tempo_wo_parada.getSeconds()) / 60)\n    //Performance\n    pf[i + 1] = (((query[i].pecas_ok + query[i].pecas_rep) ) / rt[i + 1]) / query[i].ict\n    //Availability\n    av[i + 1] = (rt[i + 1] / ppt[i + 1])\n    //Quality\n    qlt[i + 1] = (query[i].pecas_ok  / (query[i].pecas_ok + query[i].pecas_rep))\n    //Overall Equipment Effectiveness\n    oee[i + 1] = (av[i + 1] * pf[i + 1] * qlt[i + 1]) * 100\n}\n\nfor(let i=0; i < query.length; i++){\n    \n    //Planned Production Time\n    ppt[0] = ppt[0] + ppt[i + 1]\n    //Run Time\n    rt[0] = rt[0] + rt[i + 1]\n    //Performance\n    pf[0] = pf[0] + pf[i + 1]\n    //Availability\n    av[0] = av[0] + av[i + 1]\n    //Quality\n    qlt[0] = qlt[0] + qlt[i + 1]\n    //Overall Equipment Effectiveness\n    oee[0] = oee[0] + oee[i + 1]\n}\n\nppt[0] = ppt[0] / query.length\nrt[0] = rt[0] / query.length\npf[0] = pf[0] / query.length\nav[0] = av[0] / query.length\nqlt[0] = qlt[0] / query.length\noee[0] = oee[0] / query.length\n\n//Degub\nmsg.payload = \"ppt = \" + ppt +\n                \"\\nrt = \" + rt +\n                \"\\npf = \" + pf +\n                \"\\nav = \" + av +\n                \"\\nqlt = \" + qlt +\n                \"\\noee = \" + oee\n//msg.payload = query\nreturn [{\"payload\" : oee[0]}, {\"payload\" : av[0] * 100}, {\"payload\" : pf[0] * 100}, {\"payload\" : qlt[0] * 100}]\n","outputs":4,"noerr":0,"x":870,"y":460,"wires":[["bd454bee.06a0e8"],["ea7d97d.29b2868"],["e61df6ac.185d98"],["4a5c5946.81a988"]]},{"id":"2a7ef646.53b17a","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":890,"y":400,"wires":[]},{"id":"bd454bee.06a0e8","type":"ui_artlessgauge","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","order":18,"width":4,"height":4,"min":0,"max":10,"name":"OEE","icon":"OEE","label":"OEE","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":1210,"y":420,"wires":[]},{"id":"ea7d97d.29b2868","type":"ui_artlessgauge","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","order":20,"width":2,"height":2,"min":0,"max":10,"name":"Disponibilidade","icon":"","label":"Disp.","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":1240,"y":460,"wires":[]},{"id":"e61df6ac.185d98","type":"ui_artlessgauge","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","order":21,"width":2,"height":2,"min":0,"max":10,"name":"Performance","icon":"","label":"Perf.","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":1230,"y":500,"wires":[]},{"id":"4a5c5946.81a988","type":"ui_artlessgauge","z":"39d3df0.a28d222","group":"6926e97d.7c2dd8","order":22,"width":2,"height":2,"min":0,"max":10,"name":"Qualidade","icon":"OEE","label":"Quali.","unit":"%","layout":"radial","decimals":"2","differential":false,"colorTrack":"#555555","colorFromTheme":true,"sectors":[{"val":0,"col":"#f52c2c","t":"min"},{"val":45,"col":"#f2910f","t":"sec"},{"val":60,"col":"#d6db18","t":"sec"},{"val":85,"col":"#1de90e","t":"sec"},{"val":100,"col":"#1de90e","t":"max"}],"bgcolorFromTheme":true,"x":1220,"y":540,"wires":[]},{"id":"6379dff1.b918b","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":570,"y":520,"wires":[]},{"id":"4cf3a4a3.40cf4c","type":"function","z":"39d3df0.a28d222","name":"Select","func":"let date_ini = new Date(flow.get(\"tse_OEE_date_ini\"))\nlet date_fim = new Date(flow.get(\"tse_OEE_date_fim\"))\n\ndate_ini.setHours(parseInt(flow.get(\"tse_OEE_hora_ini\")[0]) + 3)\ndate_ini.setMinutes(parseInt(flow.get(\"tse_OEE_hora_ini\")[1]))\ndate_ini.setSeconds(0)\ndate_ini.setMilliseconds(0)\ndate_fim.setHours(parseInt(flow.get(\"tse_OEE_hora_fim\")[0]) + 3)\ndate_fim.setMinutes(parseInt(flow.get(\"tse_OEE_hora_fim\")[1]))\ndate_fim.setSeconds(0)\ndate_fim.setMilliseconds(0)\n\ndate_ini = global.get('StrDateTzSql')(date_ini, -3)\ndate_fim = global.get('StrDateTzSql')(date_fim, -3)\n\n\nmsg.payload = date_ini + \" - \" + date_fim\n//msg.payload = date_ini.setHours(10)\n//msg.payload = flow.get(\"tse_OEE_hora_ini\")\n//msg.payload = flow.get(\"tse_OEE_date_ini\")\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":580,"wires":[["3aa9a3d3.34ecac"]]},{"id":"3aa9a3d3.34ecac","type":"debug","z":"39d3df0.a28d222","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":550,"y":580,"wires":[]},{"id":"cde3d6ff.5387b8","type":"inject","z":"39d3df0.a28d222","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":580,"wires":[["4cf3a4a3.40cf4c"]]},{"id":"80663a32.7f2618","type":"debug","z":"39d3df0.a28d222","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":450,"y":240,"wires":[]},{"id":"a79124d4.2839f8","type":"inject","z":"48fe711.e695b9","name":"10min","topic":"","payload":"true","payloadType":"bool","repeat":"618","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":380,"wires":[["c56a0d0d.f9e28"]]},{"id":"c56a0d0d.f9e28","type":"function","z":"48fe711.e695b9","name":"Select","func":"let query\n\nquery = \"SELECT TOP (5000) * FROM Maquinas;\"\n\nreturn {\"payload\" : query, \"topic\" : \"top5000\"};","outputs":1,"noerr":0,"x":250,"y":380,"wires":[[]]},{"id":"40753e45.dbd86","type":"function","z":"48fe711.e695b9","name":"Insert - eventos","func":"const maq = global.get('tse_var_maq')\n\nlet query = \"\"\n\nif(global.get(\"tse_simu_azure_qry_ev\").length > 0){\n    \n    query = \"INSERT INTO Maquinas (timestamp, \" +\n                                \"id_maq, \" +\n                                \"id_operador, \" +\n                                \"ligado, \" +\n                                \"falha, \" +\n                                \"rodando, \" +\n                                \"manutencao, \" +\n                                \"ict, \" +\n                                \"pecas_ok, \" +\n                                \"pecas_rep, \" +\n                                \"wo, \" +\n                                \"batch, \" +\n                                \"wo_ini, \" +\n                                \"wo_fim, \" +\n                                \"wo_qtd_pcs, \" + \n                                \"ts_wo_ini, \" +\n                                \"ts_wo_fim, \" +\n                                \"tempo_wo_total, \" +\n                                \"tempo_wo_parada, \" +\n                                \"tempo_maq_rodando, \" +\n                                \"tempo_maq_parada, \" +\n                                \"str_alm\" +\n                                \") VALUES \"\n    \n    for(var i=0; i < global.get(\"tse_simu_azure_qry_ev\").length; i++){\n        \n        query = query + global.get(\"tse_simu_azure_qry_ev\")[i]\n        \n        if(i < global.get(\"tse_simu_azure_qry_ev\").length - 1){\n            \n            query = query + \", \"\n            \n        }else{\n            \n            query = query + \"; \"\n        }\n        \n    }\n    \n}\n\nglobal.set(\"tse_simu_azure_qry_ev\", [])\nreturn {\"payload\" : query}","outputs":1,"noerr":0,"x":300,"y":240,"wires":[["cb625241.0c94"]]},{"id":"24d1e344.78533c","type":"comment","z":"48fe711.e695b9","name":"Azure - Envia dados das maquinas","info":"","x":140,"y":160,"wires":[]},{"id":"5d95fb91.f2bea4","type":"MSSQL","z":"48fe711.e695b9","mssqlCN":"58b4d8e9.9e5028","name":"Sql Azure","query":"{{msg.payload}}","outField":"payload","x":1160,"y":240,"wires":[["6c1a9aa5.797644"]]},{"id":"c7fd50d2.14322","type":"debug","z":"48fe711.e695b9","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1530,"y":200,"wires":[]},{"id":"e042e0f4.73ca8","type":"delay","z":"48fe711.e695b9","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":240,"wires":[[]]},{"id":"880342de.1f9ac","type":"comment","z":"48fe711.e695b9","name":"Azure - Select para teste","info":"","x":110,"y":320,"wires":[]},{"id":"b6e63c71.3768c","type":"MSSQL","z":"48fe711.e695b9","mssqlCN":"dcb0ebcd.903ca8","name":"Consulta Sql Azure","query":"{{msg.payload}}","outField":"payload","x":450,"y":480,"wires":[["b35b26c.96717d8"]]},{"id":"b35b26c.96717d8","type":"debug","z":"48fe711.e695b9","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":480,"wires":[]},{"id":"e03c6ebb.ff402","type":"function","z":"48fe711.e695b9","name":"Insert - motores","func":"const maq = global.get('tse_var_maq')\n\nlet query = msg.payload\nlet query_ini = false\nlet cabecalho = false\n\n//verifica motores em todas as maquinas\nfor(var i=0; i < maq.length ; i++){\n    \n    //verifica se tem motor rodando\n    let rodando = false\n    \n    for(var vmot in global.get(maq[i]).motores){\n        \n        if(global.get(maq[i]).motores[vmot].corrente > 0){\n            rodando = true\n            flow.get(\"tse_mot_env_fim\")[i] = false\n        }else if(!flow.get(\"tse_mot_env_fim\")[i] && !rodando){\n            rodando = true\n            flow.get(\"tse_mot_env_fim\")[i] = true\n        }\n    }\n    \n    //Se tiver motor rodando envia dados\n    if(rodando){\n        \n        //Insere cabeçalho caso não exista\n        if(!cabecalho){\n            \n            query = query +  \"INSERT INTO Maquinas_motores (timestamp, \" +\n                                \"id_maq, \" +\n                                \"id_operador, \" +\n                                \"id_mot, \" +\n                                \"corrente, \" +\n                                \"potencia, \" +\n                                \"torque, \" +\n                                \"falha\" +\n                                \") VALUES \"\n            \n            cabecalho = true\n            \n        }\n        \n                              \n        for(var mot in global.get(maq[i]).motores){\n            \n            //Se for primeiro item não insere \", \"\n            if(!query_ini){\n                query_ini = true\n            }else{\n                query = query + \", \"\n            }\n            \n            //Adiciona na query os dados dos motores existentes\n            query = query + \"(\" +\n                            global.get('StrDateTzSql')(new Date(), -3) + \", \" +\n                            \"'\" + global.get('NomeMaq')(i) + \"', \" +\n                            \"'\" + global.get(maq[i]).id_operador + \"', \" +\n                            \"'\" + global.get(maq[i]).motores[mot].id + \"', \" +\n                            \"'\" + global.get(maq[i]).motores[mot].corrente + \"', \" +\n                            \"'\" + global.get(maq[i]).motores[mot].potencia + \"', \" +\n                            \"'\" + global.get(maq[i]).motores[mot].torque + \"', \" +\n                            \"'\" + global.get(maq[i]).motores[mot].falha + \"')\"\n                            \n            /*\n            //verifica se é o ultimo motor\n            if(i == maq.length - 1){\n                \n                if(mot != Object.keys(global.get(maq[i]).motores)[Object.keys(global.get(maq[i]).motores).length -1]){\n                    query = query + \", \"\n                }else{\n                    query = query + \"; \"\n                }\n            }else{\n                query = query + \", \"\n            }\n            */\n        }\n    }\n}\nif(cabecalho){\n    \n    query = query + \"; \"\n}\n\nif(query !== \"\"){\n    \n    return {\"payload\" : query, \"topic\" : \"insert_eventos\"}\n}\n","outputs":1,"noerr":0,"x":720,"y":240,"wires":[["5c942017.364be"]]},{"id":"cb625241.0c94","type":"function","z":"48fe711.e695b9","name":"Insert - analógicos","func":"const maq = global.get('tse_var_maq')\n\nlet query = msg.payload\nlet query_ini = false\nlet cabecalho = false\n\n\n\nfor(var i=0; i < maq.length ; i++){\n    \n    if(global.get(maq[i]).rodando){\n        \n        if(!cabecalho){\n            \n            query = query + \"INSERT INTO Maquinas_analog (timestamp, \" +\n                                \"id_maq, \" +\n                                \"id_operador, \" +\n                                \"id_inst, \" +\n                                \"value, \" +\n                                \"unid_eng, \" +\n                                \"falha\" +\n                                \") VALUES \"\n            \n            cabecalho = true\n            \n        }\n        \n        //Se for primeiro item não insere \", \"\n            if(!query_ini){\n                query_ini = true\n            }else{\n                query = query + \", \"\n            }\n      \n        //adiciona peças_ok / peças_rep junto com as variáveis analógicas  \n        query = query + \"(\" +\n                        global.get('StrDateTzSql')(new Date(), -3) + \", \" +\n                        \"'\" + global.get('NomeMaq')(i) + \"', \" +\n                        \"'\" + global.get(maq[i]).id_operador + \"', \" +\n                        \"'\" + \"pecas_ok\" + \"', \" +\n                        \"'\" + global.get(maq[i]).pecas_ok + \"', \" +\n                        \"'\" + \"unid.\" + \"', \" +\n                        \"'\" + false + \"'), \" +\n                        \"(\" +\n                        global.get('StrDateTzSql')(new Date(), -3) + \", \" +\n                        \"'\" + global.get('NomeMaq')(i) + \"', \" +\n                        \"'\" + global.get(maq[i]).id_operador + \"', \" +\n                        \"'\" + \"pecas_rep\" + \"', \" +\n                        \"'\" + global.get(maq[i]).pecas_rep + \"', \" +\n                        \"'\" + \"unid.\" + \"', \" +\n                        \"'\" + false + \"')\"\n        \n        for(var analog in global.get(maq[i]).analog){\n            \n            //Adiciona na query os dados dos analógicos existentes\n            query = query + \", (\" +\n                            global.get('StrDateTzSql')(new Date(), -3) + \", \" +\n                            \"'\" + global.get('NomeMaq')(i) + \"', \" +\n                            \"'\" + global.get(maq[i]).id_operador + \"', \" +\n                            \"'\" + global.get(maq[i]).analog[analog].id + \"', \" +\n                            \"'\" + global.get(maq[i]).analog[analog].value + \"', \" +\n                            \"'\" + global.get(maq[i]).analog[analog].ue + \"', \" +\n                            \"'\" + global.get(maq[i]).analog[analog].falha + \"')\"\n            \n            /*\n            //verifica se é o ultimo analógico                \n            if(i == maq.length - 1){\n                \n                if(analog != Object.keys(global.get(maq[i]).analog)[Object.keys(global.get(maq[i]).analog).length -1]){\n                    query = query + \", \"\n                }else{\n                    query = query + \"; \"\n                    \n                }\n            }else{\n                query = query + \", \"\n            }\n            */\n            \n        } \n        \n    }\n}\n\nif(cabecalho){\n    \n    query = query + \"; \"\n}\n\nreturn {\"payload\" : query}","outputs":1,"noerr":0,"x":510,"y":240,"wires":[["e03c6ebb.ff402"]]},{"id":"d7473ff8.5ae5f","type":"inject","z":"48fe711.e695b9","name":"10seg","topic":"","payload":"true","payloadType":"bool","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":240,"wires":[["40753e45.dbd86"]]},{"id":"b384a99a.d50a88","type":"function","z":"42adf1ec.1a792","name":"Insert - eventos","func":"const maq = flow.get(\"tse_sel_maq\")[0]\n\nlet maq_env = msg.payload\nlet query\n\nfor(var i=0; i < maq_env.length ; i++){\n    \n    query = \" (\" +\n            global.get('StrDateTzSql')(new Date(), -3) + \", \" +\n            \"'\" + global.get('NomeMaq')(flow.get(\"tse_sel_maq\")[1]) + \"', \" +\n            \"'\" + global.get(maq_env).id_operador + \"', \" +\n            \"'\" + global.get(maq_env).ligado + \"', \" +\n            \"'\" + global.get(maq_env).falha + \"', \" +\n            \"'\" + global.get(maq_env).rodando + \"', \" +\n            \"'\" + global.get(maq_env).manutencao + \"', \" +\n            \"'\" + global.get(maq_env).ict + \"', \" +\n            \"'\" + global.get(maq_env).pecas_ok + \"', \" +\n            \"'\" + global.get(maq_env).pecas_rep + \"', \" +\n            \"'\" + global.get(maq_env).wo + \"', \" +\n            \"'\" + global.get(maq_env).batch + \"', \" +\n            \"'\" + global.get(maq_env).wo_ini + \"', \" +\n            \"'\" + global.get(maq_env).wo_fim + \"', \" +\n            \"'\" + global.get(maq_env).wo_qtd_pcs + \"', \" +\n            global.get('StrDateTzSql')(global.get(maq_env).ts_wo_ini, -3) + \", \" +\n            global.get('StrDateTzSql')(global.get(maq_env).ts_wo_fim, -3) + \", \" +\n            global.get('StrDateToTimeSql')(global.get(maq_env).tempo_wo_total) + \", \" +\n            global.get('StrDateToTimeSql')(global.get(maq_env).tempo_wo_parada) + \", \" +\n            global.get('StrDateToTimeSql')(global.get(maq_env).tempo_maq_rodando) + \", \" +\n            global.get('StrDateToTimeSql')(global.get(maq_env).tempo_maq_parada) + \", \" +\n            \"'\" + global.get(maq_env).str_alm + \"'\" +\n            \")\"\n                                    \n    global.get(\"tse_simu_azure_qry_ev\").push(query)\n}\n\n//msg.payload = global.get(\"tse_simu_azure_qry_ev\")\nreturn msg","outputs":1,"noerr":0,"x":1380,"y":540,"wires":[["9f64892c.931898"]]},{"id":"50690d9b.56bbd4","type":"inject","z":"48fe711.e695b9","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":90,"y":60,"wires":[["d2552a56.1fb138"]]},{"id":"d2552a56.1fb138","type":"function","z":"48fe711.e695b9","name":"Inicialização","func":"global.set(\"tse_simu_azure_qry_ev\", [])\nflow.set(\"tse_mot_env_fim\", [])","outputs":1,"noerr":0,"x":270,"y":60,"wires":[[]]},{"id":"4e55066e.2c1fe8","type":"inject","z":"48fe711.e695b9","name":"10seg","topic":"","payload":"tse_simu_azure_qry_ev","payloadType":"global","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":630,"y":740,"wires":[["79e2eaea.0c4924"]]},{"id":"d7743dfa.e0e25","type":"debug","z":"48fe711.e695b9","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":970,"y":740,"wires":[]},{"id":"5c942017.364be","type":"debug","z":"48fe711.e695b9","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":890,"y":200,"wires":[]},{"id":"79e2eaea.0c4924","type":"function","z":"48fe711.e695b9","name":"","func":"msg.payload = global.get(\"tse_simu_azure_qry_ev\").length\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":740,"wires":[["d7743dfa.e0e25"]]},{"id":"510eac2a.43d2d4","type":"link out","z":"39d3df0.a28d222","name":"select_oee_hist","links":["5ccbcacd.8fc104"],"x":535,"y":460,"wires":[]},{"id":"5ccbcacd.8fc104","type":"link in","z":"48fe711.e695b9","name":"","links":["510eac2a.43d2d4"],"x":775,"y":300,"wires":[["e042e0f4.73ca8"]]},{"id":"6c1a9aa5.797644","type":"function","z":"48fe711.e695b9","name":"direcionamento","func":"let dados = msg\n\nif(dados.topic == \"insert_eventos\"){\n    \n    return [dados]\n    \n}else if(dados.topic == \"top5000\"){\n    \n    return [null, dados]\n    \n}else if(dados.topic == \"select_oee_hist\"){\n    \n    return [null, null,  dados]\n}","outputs":3,"noerr":0,"x":1340,"y":240,"wires":[["c7fd50d2.14322"],["179d2323.b9d73d"],["cc44a0bc.bd179"]]},{"id":"cc44a0bc.bd179","type":"link out","z":"48fe711.e695b9","name":"dados_select_oee_hist","links":["aa2342cb.1c2ee"],"x":1495,"y":280,"wires":[]},{"id":"aa2342cb.1c2ee","type":"link in","z":"39d3df0.a28d222","name":"","links":["cc44a0bc.bd179"],"x":755,"y":460,"wires":[["90a72076.a9b2f","2a7ef646.53b17a"]]},{"id":"179d2323.b9d73d","type":"debug","z":"48fe711.e695b9","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1530,"y":240,"wires":[]},{"id":"8cbb3f7.da36fc","type":"function","z":"42adf1ec.1a792","name":"opções de maquinas","func":"const maq = global.get('tse_var_maq')\n\n\n\n\nlet maquinas = global.get('MaquinasLinha')(\"*\")\nlet opt = {\"payload\" : [], \"options\" : []}\n\n\nfor(var i=0; i < maquinas.maquinas.length ; i++){\n        \n    opt.payload[i] = [maquinas.strmaquinas[i]]\n    let value = {}\n    value[maquinas.strmaquinas[i]] = i\n    opt.options.push(value)\n\n}\n\nreturn opt\n// let teste = global.get('MaquinasLinha')(\"*\")\n// // for(var i=0; i < maq.length ; i++){\n    \n// //     teste[i] = maq[i]\n// // }\n// msg.payload = teste\n// return msg;","outputs":1,"noerr":0,"x":300,"y":2640,"wires":[["c2ca12cd.64741"]]},{"id":"c2ca12cd.64741","type":"ui_dropdown","z":"42adf1ec.1a792","name":"","label":"Maquina : ","tooltip":"Selecione a maquina desejada","place":" ","group":"94774b35.ea4148","order":1,"width":10,"height":1,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":520,"y":2640,"wires":[["b027abb6.754db8"]]},{"id":"b027abb6.754db8","type":"function","z":"42adf1ec.1a792","name":"Maquina selecionada","func":"global.set(\"tse_selec_maq\", msg.payload)\n\nreturn {\"payload\" : global.get(\"tse_selec_maq\")}","outputs":1,"noerr":0,"x":740,"y":2640,"wires":[["6cfd41be.4cb59","ec177a16.5c00d8"]]},{"id":"6cfd41be.4cb59","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":2680,"wires":[]},{"id":"7fef38df.95d8c8","type":"comment","z":"42adf1ec.1a792","name":"Maquina  - Dashboard - Seleção","info":"","x":170,"y":2580,"wires":[]},{"id":"3a473208.02f2be","type":"delay","z":"42adf1ec.1a792","name":"","pauseType":"delayv","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1660,"y":1200,"wires":[["586d1aa6.da2024","d8c44d31.cb25a"]]},{"id":"586d1aa6.da2024","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"delay","targetType":"msg","x":1900,"y":1200,"wires":[]},{"id":"d73bc273.8ede3","type":"inject","z":"42adf1ec.1a792","name":"(1seg)","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1490,"y":1200,"wires":[["3a473208.02f2be"]]},{"id":"d8c44d31.cb25a","type":"function","z":"42adf1ec.1a792","name":"","func":"//msg.payload = {\"delay\" : 2000} \nreturn {\"delay\" : 10000} ;","outputs":1,"noerr":0,"x":1650,"y":1160,"wires":[["3a473208.02f2be"]]},{"id":"ad07606e.6c2eb","type":"function","z":"42adf1ec.1a792","name":"","func":"//flow.set(\"teste_hora_ini\", 0)\nvar hora_atual = new Date()\n\n\nif(flow.get(\"teste_hora_ini\") === 0){\n    flow.set(\"teste_hora_ini\", new Date())\n}\n\nif((hora_atual - flow.get(\"teste_hora_ini\")) >= 10000){\n    \n    flow.set(\"teste_hora_ini\", 0)\n    return {\"payload\" : true}\n}\n\n\n//msg.payload = hora_atual - flow.get(\"teste_hora_ini\")\n//return msg","outputs":1,"noerr":0,"x":1650,"y":1260,"wires":[["93512cd9.6ca63"]]},{"id":"93512cd9.6ca63","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1870,"y":1260,"wires":[]},{"id":"19fec9dd.094016","type":"inject","z":"42adf1ec.1a792","name":"(1seg)","topic":"","payload":"true","payloadType":"bool","repeat":"0.1","crontab":"","once":false,"onceDelay":0.1,"x":1500,"y":1260,"wires":[["ad07606e.6c2eb"]]},{"id":"e9ea2816.f95a18","type":"function","z":"42adf1ec.1a792","name":"","func":"flow.set(\"teste_hora_ini\", 0)","outputs":1,"noerr":0,"x":1650,"y":1300,"wires":[[]]},{"id":"76e944e6.7fe59c","type":"inject","z":"42adf1ec.1a792","name":"(1seg)","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1490,"y":1300,"wires":[["e9ea2816.f95a18"]]},{"id":"c9204e5f.0832f","type":"debug","z":"42adf1ec.1a792","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1970,"y":1380,"wires":[]},{"id":"c1ae81ab.64ee8","type":"function","z":"42adf1ec.1a792","name":"","func":"const maq = global.get('tse_var_maq')\n\nconst random = global.get(\"random\")\nmsg.payload = random.float(min = 0, max = 1) \nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":1380,"wires":[["c9204e5f.0832f"]]},{"id":"ff5bd642.5bee18","type":"inject","z":"42adf1ec.1a792","name":"(1seg)","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1610,"y":1380,"wires":[["c1ae81ab.64ee8"]]},{"id":"7c7f5cb2.0a10e4","type":"debug","z":"42adf1ec.1a792","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":2320,"wires":[]},{"id":"29dac7ee.6f8978","type":"random","z":"42adf1ec.1a792","name":"","low":"0","high":"100.0","inte":"false","property":"payload","x":1660,"y":1020,"wires":[["f91ec70d.932948"]]},{"id":"f91ec70d.932948","type":"function","z":"42adf1ec.1a792","name":"random maq[n]","func":"const maq = global.get('tse_var_maq')\nlet str_idx = 'tse_simu_idx_rand_wo'\nlet str_rand_val = 'rand_val_wo'\nlet idx = global.get(str_idx)\nlet random = msg.payload\n\nif(idx > maq.length){\n    \n    global.set(str_idx, 0)\n}\n\nif(idx < maq.length){\n    \n    global.get(maq[idx]).aux[str_rand_val] = random\n    global.set(str_idx, idx + 1)\n    return {'payload' : true}\n    \n}else if(idx == maq.length){\n    \n    global.set(str_idx, 0)\n    return [null, {'random' : true}]\n    \n}","outputs":2,"noerr":0,"x":1880,"y":1020,"wires":[["29dac7ee.6f8978"],["37bcdea2.6ce182"]]},{"id":"37bcdea2.6ce182","type":"debug","z":"42adf1ec.1a792","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"random","targetType":"msg","x":2150,"y":1020,"wires":[]},{"id":"8e01444d.809208","type":"inject","z":"42adf1ec.1a792","name":"pulso","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1410,"y":1020,"wires":[["29dac7ee.6f8978"]]},{"id":"161dd628.54540a","type":"inject","z":"42adf1ec.1a792","name":"pulso","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1670,"y":1080,"wires":[["ad874796.79e748"]]},{"id":"ad874796.79e748","type":"function","z":"42adf1ec.1a792","name":"","func":"const maq = global.get('tse_var_maq')\nlet idx = global.get('tse_simu_idx_rand_wo')\nlet random = msg.payload\n//for(var i=0; i < maq.length ; i++){\n\n\n// if(idx > maq.length){\n    \n//     global.set('tse_simu_idx_rand_wo', 0)\n// }\n\n// if(idx < maq.length){\n    \n//     global.get(maq[idx]).aux.rand_val_wo = random\n//     global.set('tse_simu_idx_rand_wo', idx + 1)\n//     return {'payload' : true}\n    \n// }else if(idx == maq.length){\n    \n//     global.get(maq[idx]).aux.rand_val_wo = random\n//     global.set('tse_simu_idx_rand_wo', 0)\n//     return [null, {'payload' : true}]\n    \n// }\n\nmsg.payload = global.get(maq[5]).aux.rand_val_wo\n//msg.payload = maq.length\nreturn msg;","outputs":2,"noerr":0,"x":1850,"y":1080,"wires":[["37bcdea2.6ce182"],[]]},{"id":"7385628a.150a8c","type":"function","z":"42adf1ec.1a792","name":"random maq[n]","func":"const maq = global.get('tse_var_maq')\nlet str_idx = 'tse_simu_idx_rand_liga'\nlet str_rand_val = 'rand_val_liga'\nlet idx = global.get(str_idx)\nlet random = msg.payload\n\nif(idx > maq.length){\n    \n    global.set(str_idx, 0)\n}\n\nif(idx < maq.length){\n    \n    global.get(maq[idx]).aux[str_rand_val] = random\n    global.set(str_idx, idx + 1)\n    return {'payload' : true}\n    \n}else if(idx == maq.length){\n    \n    global.set(str_idx, 0)\n    return [null, {'payload' : 'random'}]\n    \n}","outputs":2,"noerr":0,"x":460,"y":220,"wires":[["7a27c59f.c64c1c"],["ca2968ae.76cd68"]]},{"id":"e70fe5bb.c7cf88","type":"link in","z":"42adf1ec.1a792","name":"","links":["2274964a.f7ba8a"],"x":135,"y":2640,"wires":[["8cbb3f7.da36fc"]]},{"id":"ff9b9975.8dd518","type":"function","z":"42adf1ec.1a792","name":"random maq[n]","func":"const maq = global.get('tse_var_maq')\nlet str_idx = 'tse_simu_idx_rand_falha'\nlet str_rand_val = 'rand_val_falha'\nlet idx = global.get(str_idx)\nlet random = msg.payload\n\nif(idx > maq.length){\n    \n    global.set(str_idx, 0)\n}\n\nif(idx < maq.length){\n    \n    global.get(maq[idx]).aux[str_rand_val] = random\n    global.set(str_idx, idx + 1)\n    return {'payload' : true}\n    \n}else if(idx == maq.length){\n    \n    global.set(str_idx, 0)\n    return [null, {'payload' : 'random'}]\n    \n}","outputs":2,"noerr":0,"x":460,"y":400,"wires":[["34e5ddd2.c84142"],["a3d1870.aa6ec78"]]},{"id":"ec177a16.5c00d8","type":"link out","z":"42adf1ec.1a792","name":"maq_selec","links":["bbbf4132.29a95"],"x":915,"y":2640,"wires":[]},{"id":"f6d9a6d7.132518","type":"function","z":"42adf1ec.1a792","name":"random maq[n]","func":"const maq = global.get('tse_var_maq')\nlet str_idx = 'tse_simu_idx_rand_wo'\nlet str_rand_val = 'rand_val_wo'\nlet idx = global.get(str_idx)\nlet random = msg.payload\n\nif(idx > maq.length){\n    \n    global.set(str_idx, 0)\n}\n\nif(idx < maq.length){\n    \n    global.get(maq[idx]).aux[str_rand_val] = random\n    global.set(str_idx, idx + 1)\n    return {'payload' : true}\n    \n}else if(idx == maq.length){\n    \n    global.set(str_idx, 0)\n    return [null, {'payload' : 'random'}]\n    \n}","outputs":2,"noerr":0,"x":500,"y":1120,"wires":[["ac892de8.58b18"],["3e80ef4.05c681"]]},{"id":"9e0862cc.d4148","type":"function","z":"42adf1ec.1a792","name":"random maq[n]","func":"const maq = global.get('tse_var_maq')\nlet str_idx = 'tse_simu_idx_rand_rodando'\nlet str_rand_val = 'rand_val_rodando'\nlet idx = global.get(str_idx)\nlet random = msg.payload\n\nif(idx > maq.length){\n    \n    global.set(str_idx, 0)\n}\n\nif(idx < maq.length){\n    \n    global.get(maq[idx]).aux[str_rand_val] = random\n    global.set(str_idx, idx + 1)\n    return {'payload' : true}\n    \n}else if(idx == maq.length){\n    \n    global.set(str_idx, 0)\n    return [null, {'payload' : 'random'}]\n    \n}","outputs":2,"noerr":0,"x":420,"y":800,"wires":[["6ff5fb54.412f44"],["4fd394f6.dc6afc"]]},{"id":"9f64892c.931898","type":"debug","z":"42adf1ec.1a792","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1590,"y":540,"wires":[]}]